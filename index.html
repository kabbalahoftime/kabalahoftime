<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kabbalah of Time — Daily Reading</title>

<!-- PWA Configuration -->

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#8b6914">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Kabbalah of Time">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="description" content="Daily spiritual readings through the lens of Jewish mysticism and the sefirot">

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Cinzel:wght@400;500;600&family=Frank+Ruhl+Libre:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:            #f7f2e8;
    --bg-card:       #fdf9f2;
    --bg-card-alt:   #f2ead8;
    --ink:           #1e1a14;
    --ink-mid:       #3d3526;
    --ink-soft:      #6b5e45;
    --ink-dim:       #9a8a70;
    --gold:          #8b6914;
    --gold-mid:      #a07820;
    --gold-light:    #c49a2a;
    --gold-pale:     #e8d9a0;
    --border:        #d4c49a;
    --border-strong: #b8a070;
    --accent-blue:   #2a4a7a;
    --accent-red:    #7a2a2a;
    --accent-green:  #2a5a3a;
    --accent-teal:   #1a5a5a;
    --accent-orange: #7a4a1a;
    --accent-purple: #4a2a6a;
    --accent-brown:  #5a3a1a;
  }

- { margin: 0; padding: 0; box-sizing: border-box; }

body {
background: var(–bg);
color: var(–ink);
font-family: ‘Cormorant Garamond’, Georgia, serif;
min-height: 100vh;
overflow-x: hidden;
}

.app {
max-width: 680px;
margin: 0 auto;
padding: 0 20px 60px;
}

/* ── HEADER ── */
.header {
text-align: center;
padding: 44px 0 28px;
border-bottom: 2px solid var(–border-strong);
margin-bottom: 28px;
}

.star-of-david {
font-size: 26px;
color: var(–gold);
display: block;
margin-bottom: 14px;
}

.title-hebrew {
font-family: ‘Frank Ruhl Libre’, serif;
font-size: 24px;
color: var(–gold);
letter-spacing: 3px;
margin-bottom: 6px;
}

.title-main {
font-family: ‘Cinzel’, serif;
font-size: 26px;
font-weight: 600;
color: var(–ink);
letter-spacing: 3px;
text-transform: uppercase;
margin-bottom: 4px;
}

.title-sub {
font-family: ‘Cormorant Garamond’, serif;
font-style: italic;
font-size: 16px;
color: var(–ink-soft);
letter-spacing: 1px;
}

/* ── DATE SELECTOR ── */
.date-bar {
background: var(–bg-card);
border: 1px solid var(–border-strong);
border-radius: 4px;
padding: 12px 18px;
margin-bottom: 24px;
display: flex;
align-items: center;
justify-content: space-between;
gap: 12px;
box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}

.date-nav-btn {
background: var(–bg-card-alt);
border: 1px solid var(–border-strong);
color: var(–gold);
width: 34px;
height: 34px;
border-radius: 3px;
cursor: pointer;
font-size: 18px;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.15s;
flex-shrink: 0;
font-weight: bold;
}

.date-nav-btn:hover {
background: var(–gold-pale);
border-color: var(–gold);
}

.date-info { text-align: center; flex: 1; }

.date-gregorian {
font-family: ‘Cinzel’, serif;
font-size: 13px;
letter-spacing: 2px;
color: var(–ink);
text-transform: uppercase;
font-weight: 600;
}

.date-hebrew {
font-family: ‘Frank Ruhl Libre’, serif;
font-size: 15px;
color: var(–ink-soft);
margin-top: 2px;
}

.date-day-indicator {
font-size: 11px;
color: var(–ink-mid);
font-style: italic;
margin-top: 3px;
}

/* ── CROWN ── */
.keter-title-row {
text-align: center;
margin-bottom: 6px;
}
.keter-crown-label {
font-family: ‘Cinzel’, serif;
font-size: 11px;
letter-spacing: 4px;
color: var(–gold);
text-transform: uppercase;
}
.keter-card {
border: 2px solid var(–border-strong);
border-radius: 4px;
margin-bottom: 10px;
position: relative;
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
animation: fadeInDown 0.5s ease both;
cursor: pointer;
transition: all 0.2s ease;
overflow: hidden;
}

.keter-card:hover {
box-shadow: 0 3px 12px rgba(139, 105, 20, 0.15);
}

.keter-card .expand-icon {
position: absolute;
top: 16px;
right: 20px;
font-size: 14px;
color: var(–gold);
transition: transform 0.25s ease;
z-index: 2;
}

.keter-card.expanded .expand-icon {
transform: rotate(180deg);
}

.keter-visible-content {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 0;
}

.keter-detail {
display: none;
animation: fadeIn 0.25s ease;
}

.keter-card.expanded .keter-detail {
display: block;
}

.keter-detail .keter-section:not(:last-child) {
border-bottom: 1px solid var(–border);
}

.keter-card::before {
content: ‘’;
position: absolute;
top: 0; left: 0; right: 0;
height: 3px;
background: linear-gradient(90deg, transparent, var(–gold), transparent);
border-radius: 4px 4px 0 0;
z-index: 1;
}

@media (max-width: 540px) {
.keter-visible-content { grid-template-columns: 1fr; }
.keter-card .expand-icon { top: 12px; right: 16px; }
}

.keter-section {
padding: 16px 20px;
}

.keter-visible-content .keter-section:nth-child(odd) {
background: #fdf9f2 !important;
}

.keter-visible-content .keter-section:nth-child(even) {
background: #f2ead8 !important;
}

.keter-detail .keter-section {
background: var(–bg-card) !important;
}

.keter-visible-content .keter-section:not(:last-child) {
border-right: 1px solid var(–border);
}

@media (max-width: 540px) {
.keter-visible-content .keter-section:not(:last-child) {
border-right: none;
border-bottom: 1px solid var(–border);
}
}

.keter-section-label {
font-family: ‘Cinzel’, serif;
font-size: 9px;
letter-spacing: 2.5px;
color: var(–ink-dim);
text-transform: uppercase;
margin-bottom: 6px;
}

.keter-hdate {
font-size: 11px;
color: var(–gold);
font-weight: 600;
letter-spacing: 0.5px;
margin-bottom: 8px;
}

.keter-main {
font-size: 13.5px;
color: var(–ink);
line-height: 1.55;
font-style: italic;
}

.keter-meta {
font-size: 11px;
color: var(–ink-dim);
margin-top: 6px;
}

.keter-meta strong {
color: var(–gold);
}

/* ── SEFIRAH CARDS ── */
.upper-sefirot-grid {
display: grid !important;
grid-template-columns: 1fr !important;
gap: 12px;
margin-bottom: 12px;
}
.upper-sefirah {
border-left: none !important;
grid-template-columns: 96px 1fr;
}

.upper-sefirot-grid .sefirah-card:nth-child(1) {
border-top: 3px solid var(–accent-blue) !important;
}

.upper-sefirot-grid .sefirah-card:nth-child(2) {
border-top: 3px solid var(–accent-red) !important;
}
.upper-sefirah .sefirah-label-col {
overflow: hidden;
padding-right: 6px;
}
.upper-sefirah .sefirah-name {
font-size: 9.5px;
letter-spacing: 0.8px;
white-space: nowrap;
overflow: hidden;
text-overflow: clip;
}
.upper-sefirah .sefirah-hebrew {
font-size: 16px;
}

.sefirot-grid {
display: flex;
flex-direction: column;
gap: 6px;
margin-bottom: 24px;
}

.sefirah-card {
background: var(–bg-card);
border-radius: 3px;
padding: 14px 18px;
display: grid;
grid-template-columns: 86px 1fr;
gap: 14px;
align-items: start;
position: relative;
cursor: pointer;
transition: box-shadow 0.2s, transform 0.15s;
border: 1px solid var(–border);
border-left: 4px solid var(–sefirah-color, var(–gold));
box-shadow: 0 1px 3px rgba(0,0,0,0.06);
animation: fadeInUp 0.4s ease both;
}

.sefirah-card:hover {
box-shadow: 0 3px 10px rgba(0,0,0,0.12);
transform: translateY(-1px);
}

.sefirot-grid .sefirah-card:nth-child(1) { animation-delay: 0.05s; –sefirah-color: var(–accent-blue) !important; }
.sefirot-grid .sefirah-card:nth-child(2) { animation-delay: 0.10s; –sefirah-color: var(–accent-red) !important; }
.sefirot-grid .sefirah-card:nth-child(3) { animation-delay: 0.15s; –sefirah-color: var(–accent-green) !important; }
.sefirot-grid .sefirah-card:nth-child(4) { animation-delay: 0.20s; –sefirah-color: var(–accent-orange) !important; }
.sefirot-grid .sefirah-card:nth-child(5) { animation-delay: 0.25s; –sefirah-color: var(–accent-teal) !important; }
.sefirot-grid .sefirah-card:nth-child(6) { animation-delay: 0.30s; –sefirah-color: var(–accent-purple) !important; }
.sefirot-grid .sefirah-card:nth-child(7) { animation-delay: 0.35s; –sefirah-color: var(–accent-brown) !important; }

.sefirah-label-col {
display: flex;
flex-direction: column;
align-items: flex-start;
padding-top: 2px;
border-right: 1px solid var(–border);
padding-right: 12px;
}

.sefirah-name {
font-family: ‘Cinzel’, serif;
font-size: 11px;
letter-spacing: 2px;
text-transform: uppercase;
color: var(–sefirah-color, var(–gold));
margin-bottom: 5px;
font-weight: 600;
}

.sefirah-hebrew {
font-family: ‘Frank Ruhl Libre’, serif;
font-size: 22px;
color: var(–sefirah-color, var(–gold));
line-height: 1;
opacity: 0.85;
}

.sefirah-content-col { padding-left: 2px; }

.sefirah-cycle-name {
font-family: ‘Cinzel’, serif;
font-size: 10px;
letter-spacing: 2px;
text-transform: uppercase;
color: var(–ink-dim);
margin-bottom: 5px;
}

.sefirah-main-text {
font-size: 18px;
color: var(–ink);
line-height: 1.45;
font-weight: 400;
}

.sefirah-main-text strong {
font-weight: 700;
color: var(–sefirah-color, var(–gold));
}

.sefirah-sub-text {
font-size: 14px;
color: var(–ink-soft);
margin-top: 5px;
font-style: italic;
line-height: 1.5;
}

.sefirah-tags {
display: flex;
flex-wrap: wrap;
gap: 5px;
margin-top: 7px;
}

.tag {
font-size: 11px;
padding: 2px 9px;
border-radius: 2px;
background: var(–bg-card-alt);
border: 1px solid var(–border);
color: var(–ink-mid);
letter-spacing: 0.3px;
font-family: ‘Cormorant Garamond’, serif;
}

.tag.highlight {
background: var(–gold-pale);
border-color: var(–border-strong);
color: var(–gold);
font-weight: 600;
}

/* ── EXPANDED DETAIL ── */
.sefirah-detail {
display: none;
padding-top: 10px;
border-top: 1px solid var(–border);
margin-top: 10px;
background: var(–bg-card);
}

.sefirah-card.expanded .sefirah-detail {
display: block;
animation: fadeIn 0.25s ease;
}

.detail-row {
display: flex;
gap: 10px;
margin-bottom: 6px;
font-size: 14px;
line-height: 1.4;
}

.detail-label {
color: var(–gold-mid);
font-style: italic;
min-width: 110px;
flex-shrink: 0;
font-weight: 500;
}

.detail-value { color: var(–ink-mid); }

/* ── DIVIDER ── */
.section-divider {
display: flex;
align-items: center;
gap: 14px;
margin: 20px 0 14px;
}

.section-divider::before,
.section-divider::after {
content: ‘’;
flex: 1;
height: 1px;
background: var(–border-strong);
}

.divider-symbol {
color: var(–gold);
font-size: 13px;
}

/* ── WEEKLY SECTION ── */
.weekly-section {
background: var(–bg-card);
border: 1px solid var(–border-strong);
border-radius: 4px;
padding: 18px 22px;
margin-bottom: 8px;
box-shadow: 0 1px 3px rgba(0,0,0,0.06);
animation: fadeInUp 0.4s ease 0.4s both;
}

.weekly-header {
display: flex;
align-items: center;
justify-content: space-between;
margin-bottom: 14px;
flex-wrap: wrap;
gap: 8px;
}

.weekly-title {
font-family: ‘Cinzel’, serif;
font-size: 10px;
letter-spacing: 3px;
text-transform: uppercase;
color: var(–ink-dim);
}

.weekly-badge {
font-size: 13px;
padding: 3px 10px;
border: 1px solid var(–border-strong);
color: var(–gold);
border-radius: 2px;
font-family: ‘Cormorant Garamond’, serif;
font-style: italic;
background: var(–bg-card-alt);
}

.weekly-items {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
}

.weekly-item {
padding: 12px;
background: var(–bg-card-alt);
border: 1px solid var(–border);
border-radius: 3px;
}

.weekly-item-label {
font-size: 10px;
letter-spacing: 2px;
text-transform: uppercase;
color: var(–ink-dim);
margin-bottom: 5px;
font-family: ‘Cinzel’, serif;
}

.weekly-item-value {
font-size: 17px;
color: var(–ink);
font-weight: 500;
}

.weekly-item-sub {
font-size: 12px;
color: var(–ink-soft);
font-style: italic;
margin-top: 3px;
}
.weekly-book-row {
display: flex;
gap: 12px;
padding: 10px 12px;
background: var(–bg-card-alt);
border: 1px solid var(–border);
border-radius: 3px;
margin-bottom: 6px;
align-items: flex-start;
}

.weekly-book-label {
font-size: 10px;
letter-spacing: 1.5px;
text-transform: uppercase;
color: var(–gold);
font-family: ‘Cinzel’, serif;
min-width: 62px;
padding-top: 2px;
opacity: 0.85;
}

.weekly-book-content {
flex: 1;
}

.weekly-book-subrow {
display: flex;
gap: 6px;
flex-wrap: wrap;
margin-top: 5px;
}

.weekly-tag {
font-size: 11px;
padding: 2px 8px;
border-radius: 10px;
background: rgba(184,142,77,0.12);
color: var(–ink-soft);
border: 1px solid var(–border);
}

/* ── MALCHUT EXPANDED PANEL ── */
.mal-today-highlight {
background: linear-gradient(135deg, rgba(180,140,60,0.12), rgba(180,140,60,0.05));
border: 2px solid var(–gold);
border-radius: 3px;
padding: 8px;
margin-bottom: 12px;
}
.mal-today-badge {
font-family: ‘Cinzel’, serif;
font-size: 9px;
letter-spacing: 2px;
color: var(–gold);
text-transform: uppercase;
margin-bottom: 6px;
padding-left: 4px;
}
.mal-week-divider {
border: none;
border-top: 1px solid var(–border);
margin: 14px 0 10px 0;
}

.mal-parasha-header {
display: flex;
flex-direction: column;
gap: 2px;
padding: 6px 8px 8px;
margin-bottom: 8px;
border-bottom: 1px solid var(–border);
font-size: 11px;
color: var(–text-dim);
}
.mal-parasha-header strong {
color: var(–gold);
font-size: 13px;
font-family: ‘Cinzel’, serif;
letter-spacing: 0.5px;
}

.mal-book-row {
border: 1px solid var(–border);
border-radius: 5px;
margin-bottom: 6px;
overflow: hidden;
}
.mal-today {
border-color: var(–gold);
background: rgba(184,142,77,0.07);
}

.mal-book-header {
display: flex;
align-items: baseline;
gap: 6px;
padding: 5px 8px 3px;
border-bottom: 1px solid var(–border);
flex-wrap: wrap;
}
.mal-today .mal-book-header {
background: rgba(184,142,77,0.1);
}

.mal-night {
font-size: 9px;
letter-spacing: 1px;
text-transform: uppercase;
color: var(–text-dim);
white-space: nowrap;
}
.mal-text-name {
font-size: 12px;
font-weight: 600;
color: var(–text-main);
font-family: ‘Cinzel’, serif;
flex: 1;
}
.mal-today .mal-text-name {
color: var(–gold);
}
.mal-book-label {
font-size: 9px;
letter-spacing: 0.8px;
text-transform: uppercase;
color: var(–gold);
opacity: 0.75;
white-space: nowrap;
}
.mal-today .mal-book-label {
opacity: 1;
}

.mal-fields {
padding: 4px 8px 5px;
}
.mal-field {
display: flex;
gap: 6px;
align-items: baseline;
padding: 2px 0;
font-size: 11px;
line-height: 1.4;
}
.mal-field-label {
font-size: 9px;
letter-spacing: 0.8px;
text-transform: uppercase;
color: var(–gold);
opacity: 0.7;
white-space: nowrap;
min-width: 80px;
padding-top: 1px;
}
.mal-today .mal-field-label {
opacity: 1;
}
.mal-field-value {
color: var(–text-main);
flex: 1;
}

.detail-source {
display: block;
font-size: 10px;
letter-spacing: 1.5px;
text-transform: uppercase;
color: var(–gold);
opacity: 0.8;
margin-bottom: 2px;
font-family: ‘Cinzel’, serif;
}

.detail-today {
background: rgba(184,142,77,0.12);
border-radius: 3px;
padding: 2px 4px;
margin: 1px -4px;
}

.detail-today .detail-label {
color: var(–gold);
font-weight: 600;
}

.detail-week-header .detail-label {
color: var(–gold);
font-weight: 600;
font-size: 11px;
letter-spacing: 0.5px;
}

.detail-week-header {
margin-bottom: 4px;
padding-bottom: 4px;
border-bottom: 1px solid var(–border);
}

.ww-label-zohar  { color: #9b7fc8; }
.ww-label-ls     { color: var(–gold); }
.ww-label-kst    { color: #e8c97a; }
.ww-label-ne     { color: #7ec8a0; }
.ww-label-tanya  { color: #7ab8e8; }
.ww-label-lm     { color: #e87a7a; }
.ww-label-my     { color: #c8a07e; }

.weekly-tag.dim {
opacity: 0.75;
font-style: italic;
}

/* ── FOOTER ── */
.footer {
text-align: center;
padding: 28px 0 0;
border-top: 1px solid var(–border);
margin-top: 28px;
}

.footer-text {
font-size: 13px;
color: var(–ink-soft);
font-style: italic;
letter-spacing: 1px;
}

.footer-authors {
font-family: ‘Cinzel’, serif;
font-size: 11px;
letter-spacing: 2px;
color: var(–gold);
margin-top: 6px;
text-transform: uppercase;
}

/* ── ANIMATIONS ── */
@keyframes fadeInDown {
from { opacity: 0; transform: translateY(-10px); }
to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeInUp {
from { opacity: 0; transform: translateY(10px); }
to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
from { opacity: 0; }
to   { opacity: 1; }
}

/* ── EXPAND ICON ── */
.expand-icon {
position: absolute;
right: 12px;
top: 14px;
color: var(–ink-dim);
font-size: 11px;
transition: transform 0.3s;
}
.sefirah-card.expanded .expand-icon { transform: rotate(180deg); }

/* ── RESPONSIVE ── */
@media (max-width: 480px) {
.sefirah-card { grid-template-columns: 70px 1fr; gap: 10px; }
.weekly-items { grid-template-columns: 1fr; }
.title-main { font-size: 20px; }
.crown-text { font-size: 17px; }
.sefirah-main-text { font-size: 16px; }
}
</style>

</head>
<body>

<div class="app">

  <!-- HEADER -->

  <header class="header">
    <span class="star-of-david">✦</span>
    <div class="title-hebrew">קַבָּלַת הַזְּמַן</div>
    <div class="title-main">Kabbalah of Time</div>
    <div class="title-sub">Daily Reading — ספירת הזמן</div>
  </header>

  <!-- DATE BAR -->

  <div class="date-bar">
    <button class="date-nav-btn" onclick="changeDay(-1)">‹</button>
    <div class="date-info">
      <div class="date-gregorian" id="gregorian-date">Monday, February 10, 2026</div>
      <div class="date-hebrew" id="hebrew-date">…</div>
      <div class="date-day-indicator" id="day-indicator">Last Night: Day X · Tonight Begins: Day Y</div>
    </div>
    <button class="date-nav-btn" onclick="changeDay(1)">›</button>
  </div>

  <!-- CROWN — YEARLY CYCLE -->

  <div class="keter-title-row">
    <span class="keter-crown-label">✦ KETER ✦</span>
  </div>
  <div class="keter-card" onclick="toggleKeterExpand(this, event)">
    <span class="expand-icon">▾</span>

```
<!-- Always visible sections -->
<div class="keter-visible-content">
  <!-- HAYOM YOM section -->
  <div class="keter-section">
    <div class="keter-section-label">✦ Hayom Yom — היום יום</div>
    <div class="keter-main" id="keter-hayomyom">Loading…</div>
    <div class="keter-meta" id="keter-hy-meta"></div>
  </div>
  <!-- DAILY LM section -->
  <div class="keter-section">
    <div class="keter-section-label">✦ Daily Likutei Moharan</div>
    <div class="keter-main" id="keter-lm-main">Loading…</div>
    <div class="keter-meta" id="keter-lm-meta"></div>
  </div>
  <!-- DAF YOMI section -->
  <div class="keter-section">
    <div class="keter-section-label">✦ Daf Yomi — דַּף יוֹמִי</div>
    <div class="keter-hdate" id="keter-daf-masechet">Loading…</div>
    <div class="keter-main" id="keter-daf-main">Loading…</div>
    <div class="keter-meta" id="keter-daf-meta"></div>
  </div>
</div>

<!-- Expandable detail sections -->
<div class="keter-detail">
  <div class="section-divider" style="margin: 16px 0">
    <span class="divider-symbol">◆</span>
  </div>
  <!-- CHUMASH section -->
  <div class="keter-section">
    <div class="keter-section-label">✦ Chumash with Rashi</div>
    <div class="keter-hdate" id="keter-chumash-date">Loading…</div>
    <div class="keter-main" id="keter-chumash-main">Loading…</div>
    <div class="keter-meta" id="keter-chumash-meta"></div>
  </div>
  <!-- TEHILLIM section -->
  <div class="keter-section">
    <div class="keter-section-label">✦ Tehillim</div>
    <div class="keter-main" id="keter-tehillim-main">Loading…</div>
    <div class="keter-meta" id="keter-tehillim-meta"></div>
  </div>
  <!-- TANYA section -->
  <div class="keter-section">
    <div class="keter-section-label">✦ Tanya</div>
    <div class="keter-main" id="keter-tanya-main">Loading…</div>
    <div class="keter-meta" id="keter-tanya-meta"></div>
  </div>
  <!-- RAMBAM section -->
  <div class="keter-section">
    <div class="keter-section-label">✦ Rambam</div>
    <div class="keter-main" id="keter-rambam-main">Loading…</div>
    <div class="keter-meta" id="keter-rambam-meta"></div>
  </div>
</div>
```

  </div>
  <div class="upper-sefirot-grid" id="upper-sefirot-grid">

```
<!-- CHOCHMAH: 22-Day Alef-Bet Cycle -->
<div class="sefirah-card upper-sefirah" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name" style="color:var(--accent-blue)">Chochmah</div>
    <div class="sefirah-hebrew" style="color:var(--accent-blue)">חָכְמָה</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name" id="chochmah-cycle-name">Alef-Bet — 22-Day Cycle</div>
    <div class="sefirah-main-text" id="chochmah-main">Loading…</div>
    <div class="sefirah-sub-text" id="chochmah-sub"></div>
    <div class="sefirah-tags" id="chochmah-tags"></div>
    <div class="sefirah-detail" id="chochmah-detail"></div>
  </div>
</div>

<!-- BINAH: 7×7×7 Sefirot Omer Cycle -->
<div class="sefirah-card upper-sefirah" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name" style="color:var(--accent-red)">Binah</div>
    <div class="sefirah-hebrew" style="color:var(--accent-red)">בִּינָה</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name" id="binah-cycle-name">Sefirot — 7×7×7 Cycle</div>
    <div class="sefirah-main-text" id="binah-main">Loading…</div>
    <div class="sefirah-sub-text" id="binah-sub"></div>
    <div class="sefirah-tags" id="binah-tags"></div>
    <div class="sefirah-detail" id="binah-detail"></div>
  </div>
</div>
```

  </div>

  <div class="section-divider">
    <span class="divider-symbol">◆</span>
  </div>

  <!-- 7 SEFIROT CARDS -->

  <div class="sefirot-grid" id="sefirot-grid">

```
<!-- CHESED: Mishna / Tosefta -->
<div class="sefirah-card" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name">Chesed</div>
    <div class="sefirah-hebrew">חֶסֶד</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name" id="chesed-cycle-name">Mishna — Oral Torah</div>
    <div class="sefirah-main-text" id="chesed-main">Loading…</div>
    <div class="sefirah-sub-text" id="chesed-sub"></div>
    <div class="sefirah-tags" id="chesed-tags"></div>
    <div class="sefirah-detail" id="chesed-detail"></div>
  </div>
</div>

<!-- GEVURAH: Tanach -->
<div class="sefirah-card" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name">Gevurah</div>
    <div class="sefirah-hebrew">גְּבוּרָה</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name" id="gevurah-cycle-name">Tanach — Nevi'im &amp; Ketuvim</div>
    <div class="sefirah-main-text" id="gevurah-main">Loading…</div>
    <div class="sefirah-sub-text" id="gevurah-sub"></div>
    <div class="sefirah-tags" id="gevurah-tags"></div>
    <div class="sefirah-detail" id="gevurah-detail"></div>
  </div>
</div>

<!-- TIFERET: 13-Day Cycle (dynamic) -->
<div class="sefirah-card" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name">Tiferet</div>
    <div class="sefirah-hebrew">תִּפְאֶרֶת</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name">13 Attributes — 13-Day Cycle</div>
    <div class="sefirah-main-text">Loading…</div>
    <div class="sefirah-sub-text"></div>
    <div class="sefirah-tags"></div>
    <div class="sefirah-detail"></div>
  </div>
</div>

<!-- NETZACH: 41-Day Cycle (dynamic) -->
<div class="sefirah-card" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name">Netzach</div>
    <div class="sefirah-hebrew">נֶצַח</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name">41-Day Cycle — Mivtzoyim</div>
    <div class="sefirah-main-text">Loading…</div>
    <div class="sefirah-sub-text"></div>
    <div class="sefirah-tags"></div>
    <div class="sefirah-detail"></div>
  </div>
</div>

<!-- HOD: Halacha -->
<div class="sefirah-card" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name">Hod</div>
    <div class="sefirah-hebrew">הוֹד</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name">Halacha — Daily Law</div>
    <div class="sefirah-main-text">Loading…</div>
    <div class="sefirah-sub-text">Loading…</div>
    <div class="sefirah-tags"></div>
    <div class="sefirah-detail"></div>
  </div>
</div>

<!-- YESOD: Shovavim / Parasha -->
<div class="sefirah-card" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name">Yesod</div>
    <div class="sefirah-hebrew">יְסוֹד</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name">Shovavim — Parasha Cycle</div>

    <!-- Exact blog markup, restyled -->
    <div id="yesod-parasha-name" class="sefirah-main-text">Loading...</div>
    <div id="yesod-parasha-numbers" class="sefirah-sub-text"></div>
    <div class="sefirah-detail">
      <div id="yesod-parasha-cycle" style="font-size:14px; line-height:1.7; color:var(--ink-mid);"></div>
    </div>
  </div>
</div>

<style>
  /* Override cycle-label class inside Yesod card to match parchment theme */
  #yesod-parasha-cycle .cycle-label {
    color: var(--gold-mid);
    font-weight: 600;
    display: block;
    margin-top: 4px;
    border-top: 1px solid var(--border);
    padding-top: 4px;
    font-style: italic;
  }
</style>

<script>
(function() {
    const parashotData = [
        { date: "2025-09-27", name: "Vayeilech", numbers: [52], isHoliday: false },
        { date: "2025-10-04", name: "Haazinu", numbers: [53], isHoliday: false },
        { date: "2025-10-11", name: "Sukkot V (CH''M)", numbers: [], isHoliday: true },
        { date: "2025-10-18", name: "Bereshit", numbers: [1], isHoliday: false },
        { date: "2025-10-25", name: "Noach", numbers: [2], isHoliday: false },
        { date: "2025-11-01", name: "Lech Lecha", numbers: [3], isHoliday: false },
        { date: "2025-11-08", name: "Vayeira", numbers: [4], isHoliday: false },
        { date: "2025-11-15", name: "Chayei Sara", numbers: [5], isHoliday: false },
        { date: "2025-11-22", name: "Toledot", numbers: [6], isHoliday: false },
        { date: "2025-11-29", name: "Vayetzei", numbers: [7], isHoliday: false },
        { date: "2025-12-06", name: "Vayishlach", numbers: [8], isHoliday: false },
        { date: "2025-12-13", name: "Vayeshev", numbers: [9], isHoliday: false },
        { date: "2025-12-20", name: "Miketz", numbers: [10], isHoliday: false },
        { date: "2025-12-27", name: "Vayigash", numbers: [11], isHoliday: false },
        { date: "2026-01-03", name: "Vayechi", numbers: [12], isHoliday: false },
        { date: "2026-01-10", name: "Shemot", numbers: [13], isHoliday: false },
        { date: "2026-01-17", name: "Vaera", numbers: [14], isHoliday: false },
        { date: "2026-01-24", name: "Bo", numbers: [15], isHoliday: false },
        { date: "2026-01-31", name: "Beshalach", numbers: [16], isHoliday: false },
        { date: "2026-02-07", name: "Yitro", numbers: [17], isHoliday: false },
        { date: "2026-02-14", name: "Mishpatim", numbers: [18], isHoliday: false },
        { date: "2026-02-21", name: "Terumah", numbers: [19], isHoliday: false },
        { date: "2026-02-28", name: "Tetzaveh", numbers: [20], isHoliday: false },
        { date: "2026-03-07", name: "Ki Tisa", numbers: [21], isHoliday: false },
        { date: "2026-03-14", name: "Vayakhel-Pekudei", numbers: [22, 23], isHoliday: false },
        { date: "2026-03-21", name: "Vayikra", numbers: [24], isHoliday: false },
        { date: "2026-03-28", name: "Tzav", numbers: [25], isHoliday: false },
        { date: "2026-04-04", name: "Pesach III (CH''M)", numbers: [], isHoliday: true },
        { date: "2026-04-11", name: "Shmini", numbers: [26], isHoliday: false },
        { date: "2026-04-18", name: "Tazria-Metzora", numbers: [27, 28], isHoliday: false },
        { date: "2026-04-25", name: "Achrei Mot-Kedoshim", numbers: [29, 30], isHoliday: false },
        { date: "2026-05-02", name: "Emor", numbers: [31], isHoliday: false },
        { date: "2026-05-09", name: "Behar-Bechukotai", numbers: [32, 33], isHoliday: false },
        { date: "2026-05-16", name: "Bamidbar", numbers: [34], isHoliday: false },
        { date: "2026-05-23", name: "Shavuot II", numbers: [], isHoliday: true },
        { date: "2026-05-30", name: "Nasso", numbers: [35], isHoliday: false },
        { date: "2026-06-06", name: "Behaalotecha", numbers: [36], isHoliday: false },
        { date: "2026-06-13", name: "Shlach", numbers: [37], isHoliday: false },
        { date: "2026-06-20", name: "Korach", numbers: [38], isHoliday: false },
        { date: "2026-06-27", name: "Chukat-Balak", numbers: [39, 40], isHoliday: false },
        { date: "2026-07-04", name: "Pinchas", numbers: [41], isHoliday: false },
        { date: "2026-07-11", name: "Matot-Masei", numbers: [42, 43], isHoliday: false },
        { date: "2026-07-18", name: "Devarim", numbers: [44], isHoliday: false },
        { date: "2026-07-25", name: "Vaetchanan", numbers: [45], isHoliday: false },
        { date: "2026-08-01", name: "Eikev", numbers: [46], isHoliday: false },
        { date: "2026-08-08", name: "Re'eh", numbers: [47], isHoliday: false },
        { date: "2026-08-15", name: "Shoftim", numbers: [48], isHoliday: false },
        { date: "2026-08-22", name: "Ki Teitzei", numbers: [49], isHoliday: false },
        { date: "2026-08-29", name: "Ki Tavo", numbers: [50], isHoliday: false },
        { date: "2026-09-05", name: "Nitzavim-Vayeilech", numbers: [51, 52], isHoliday: false }
    ];
    const cycles = [
        { cycle: 1, start: 1, end: 6 },
        { cycle: 2, start: 7, end: 12 },
        { cycle: 3, start: 13, end: 20 },
        { cycle: 4, start: 21, end: 28 },
        { cycle: 5, start: 29, end: 36 },
        { cycle: 6, start: 37, end: 42 },
        { cycle: 7, start: 43, end: 48 },
        { cycle: 8, start: 49, end: 54 }
    ];
    const qualitiesData = {
        1: { letter: "Shin", name: "Moshe", concept: "Torah", service: "Shiviti" },
        2: { letter: "Vav", name: "Aharon", concept: "Avodah", service: "Ve'Ahavta" },
        3: { letter: "Beit (1)", name: "Mordechai", concept: "Mesirut Nefesh & Tzedaka", service: "B'chol" },
        4: { letter: "Beit (2) (Heh)", name: "Esther", concept: "Taanit", service: "Hatzneah" },
        5: { letter: "Yud", name: "Rashbi", concept: "Tikkun Klali", service: "Tamim" },
        6: { letter: "Mem Sofit", name: "Ari", concept: "Mikvah", service: "Tamim" },
        7: { letter: "Tav (1)", name: "Moshiach", concept: "Tikkun Leah", service: "Tamim" },
        8: { letter: "Tav (2)", name: "Eliyahu", concept: "Tikkun Rachel/Perek Shira", service: "Tamim" }
    };

    function getNextShabbat(d) { let day = d.getDay(); let diff = (6 - day + 7) % 7; let s = new Date(d); s.setDate(d.getDate() + diff); s.setHours(0,0,0,0); return s; }
    function formatDate(d) { return d.getFullYear() + '-' + (d.getMonth()+1).toString().padStart(2,'0') + '-' + d.getDate().toString().padStart(2,'0'); }
    function getQualities(n) { return qualitiesData[n] || null; }

    function getCycleAndRelativeNumberForParasha(n) {
        for (const c of cycles) { if (n >= c.start && n <= c.end) return { cycle: c.cycle, relativeNumber: n - c.start + 1, cycleLength: c.end - c.start + 1 }; }
        return null;
    }

    function findCurrentParasha(f) {
        let cp = null, ci = -1;
        for (let i=0; i<parashotData.length; i++) { if (parashotData[i].date <= f) { cp = parashotData[i]; ci = i; } else break; }
        if (cp && cp.isHoliday) { for (let i=ci+1; i<parashotData.length; i++) { if (!parashotData[i].isHoliday) return parashotData[i]; } }
        return cp;
    }

    function displayParasha() {
        const foundParasha = findCurrentParasha(formatDate(getNextShabbat(new Date())));
        if (foundParasha) {
            document.getElementById('yesod-parasha-name').textContent = foundParasha.name;
            document.getElementById('yesod-parasha-numbers').textContent =
                'Shovavim Week: ' + (foundParasha.numbers.length > 0 ? foundParasha.numbers.join(', ') : 'N/A');

            let cycleOutput = foundParasha.numbers.map(num => {
                const cycleData = getCycleAndRelativeNumberForParasha(num);
                if (cycleData) {
                    const pQ = getQualities(cycleData.relativeNumber);
                    const cQ = getQualities(cycleData.cycle);
                    let pText = pQ ? `<strong>Parasha ${cycleData.relativeNumber}:</strong> ${pQ.letter}, ${pQ.service}, ${pQ.name}, ${pQ.concept}` : `<strong>Parasha ${cycleData.relativeNumber}</strong>`;
                    if (cycleData.cycleLength === 6) {
                        let ex = null;
                        if (cycleData.relativeNumber === 5) ex = getQualities(7);
                        if (cycleData.relativeNumber === 6) ex = getQualities(8);
                        if (ex) pText += `<br>+ ${ex.letter}, ${ex.service}, ${ex.name}, ${ex.concept}`;
                    }
                    let cText = cQ
                        ? `<span class="cycle-label">in <strong>Cycle ${cycleData.cycle}:</strong> ${cQ.letter}, ${cQ.service}, ${cQ.name}, ${cQ.concept}</span>`
                        : `<span class="cycle-label">in Cycle ${cycleData.cycle}</span>`;
                    return `<div style="margin-bottom:4px;">${pText}${cText}</div>`;
                }
                return `Parasha ${num}`;
            }).join('<hr style="border:0; border-top:1px dashed var(--border); margin:8px 0;">');

            document.getElementById('yesod-parasha-cycle').innerHTML = cycleOutput;
        }
    }
    displayParasha();
})();
</script>

<!-- MALCHUT: Daily Text + Weekly Book -->
<div class="sefirah-card malchut-card" onclick="toggleExpand(this)">
  <span class="expand-icon">▾</span>
  <div class="sefirah-label-col">
    <div class="sefirah-name">Malchut</div>
    <div class="sefirah-hebrew">מַלְכוּת</div>
  </div>
  <div class="sefirah-content-col">
    <div class="sefirah-cycle-name" id="malchut-cycle-name">Daily Text</div>
    <div class="sefirah-main-text" id="malchut-main">Loading…</div>
    <div class="sefirah-sub-text" id="malchut-sub"></div>
    <div class="sefirah-tags" id="malchut-tags"></div>
    <div class="sefirah-detail" id="malchut-detail">
      <!-- Weekly book content injected by render() -->
    </div>
  </div>
</div>
```

  </div>

  <!-- FOOTER -->

  <footer class="footer">
    <div class="footer-text">Based on the book</div>
    <div class="footer-authors">Kabbalah of Time · by Ann Helen Wainer and Rabbi Daniel Kahane</div>
    <div class="footer-text" style="margin-top:8px;">kabbalahoftime.com</div>
  </footer>

</div>

<script>
  // ── KOT YEAR ANCHOR ──
  // Week 1, Day 1 = Friday before Rosh Hashana = Sep 19, 2025
  const KOT_YEAR_START = new Date(2025, 8, 19); // month is 0-indexed

  function getKotWeekDay(offsetDays) {
    const d = new Date();
    d.setDate(d.getDate() + offsetDays);
    const msPerDay = 1000 * 60 * 60 * 24;
    const delta = Math.floor((d - KOT_YEAR_START) / msPerDay);
    const week  = Math.floor(delta / 7) + 1;
    const day   = (delta % 7) + 1; // 1–7
    return { delta, week, day };
  }

  // ── MISHNA DATA (52 weeks × 10 chapters = 520, days 1-5 of each KoT week) ──
  const MISHNA_TRACTATES = [
    ["Brachot",9],["Peah",8],["Demai",7],["Kilayim",9],["Shvi'it",10],
    ["Trumot",11],["Maasrot",5],["Maaser Sheni",5],["Chalah",4],["Orlah",3],["Bikkurim",4],
    ["Shabat",24],["Eruvin",10],["Pesachim",10],["Shekalim",8],["Yoma",8],
    ["Sukkah",5],["Beitzah",5],["Rosh Hashana",4],["Taanit",4],["Megillah",4],
    ["Moed Katan",3],["Chagigah",3],
    ["Yevamot",16],["Ketubot",13],["Nedarim",11],["Nazir",9],
    ["Sotah",9],["Gittin",9],["Kiddushin",4],
    ["Bava Kama",10],["Bava Metzia",10],["Bava Batra",10],
    ["Sanhedrin",11],["Makkot",3],["Shvuot",8],["Eduyot",8],
    ["Avodah Zarah",5],["Avot",5],["Horayot",3],
    ["Zevachim",14],["Menachot",13],["Chulin",12],["Bechorot",9],
    ["Erchin",9],["Temurah",7],["Keritut",6],["Me'ilah",6],
    ["Tamid",7],["Midot",5],["Kinim",3],
    ["Kelim",30],["Ohalot",18],["Nega'im",14],["Parah",12],
    ["Taharot",10],["Mikva'ot",10],["Niddah",10],["Machshirim",6],
    ["Zavim",5],["Tevul Yom",4],["Yadayim",4],["Uktzin",3]
  ];

  const MISHNA_FLAT = [];
  for (const [name, chs] of MISHNA_TRACTATES)
    for (let c = 1; c <= chs; c++) MISHNA_FLAT.push([name, c]);

  // ── TOSEFTA DATA (52 weeks × 8 chapters = 416, days 6-7 of each KoT week) ──
  const TOSEFTA_TRACTATES = [
    ["Brachot",6],["Peah",4],["Demai",6],["Kilayim",5],["Shvi'it",8],
    ["Trumot",10],["Maasrot",3],["Maaser Sheni",5],["Chalah",2],["Orlah",1],["Bikkurim",2],
    ["Shabat",18],["Eruvin",11],["Pesachim",10],["Shekalim",3],["Yoma",5],
    ["Sukkah",4],["Yom Tov",4],["Rosh Hashana",2],["Taanit",3],["Megillah",4],
    ["Chagigah",3],["Moed Katan",2],
    ["Yevamot",14],["Ketubot",12],["Nedarim",7],["Nazir",6],
    ["Sotah",15],["Gittin",7],["Kiddushin",5],
    ["Bava Kama",11],["Bava Metzia",11],["Bava Batra",11],
    ["Sanhedrin",14],["Makkot",5],["Shvuot",6],["Eduyot",3],
    ["Avodah Zarah",9],["Horayot",2],
    ["Zevachim",13],["Menachot",13],["Chulin",10],["Bechorot",7],
    ["Erchin",5],["Temurah",4],["Keritut",4],["Me'ilah",2],["Tamid",3],
    ["Kelim Bava Kama",6],["Kelim Bava Metzia",6],["Kelim Bava Batra",8],
    ["Ohalot",18],["Nega'im",9],["Parah",12],["Taharot",11],
    ["Mikva'ot",8],["Niddah",9],["Machshirim",3],["Zavim",5],
    ["Tevul Yom",2],["Yadayim",2],["Uktzin",3]
  ];

  const TOSEFTA_FLAT = [];
  for (const [name, chs] of TOSEFTA_TRACTATES)
    for (let c = 1; c <= chs; c++) TOSEFTA_FLAT.push([name, c]);

  // ── TANACH DATA (52 weeks × 7 days × 2 chapters = 364 days, 728 chapters) ──
  const TANACH_TRACTATES = [
    ["Joshua",24],["Judges",21],["Shmuel I",31],["Shmuel II",24],
    ["Kings I",22],["Kings II",25],
    ["Isaiah",66],["Jeremiah",52],["Ezekiel",48],
    ["Hoshea",14],["Joel",4],["Amos",9],["Obadiah",1],["Yonah",4],
    ["Micha",7],["Nachum",3],["Habakkuk",3],["Tzefanaiah",3],
    ["Chaggai",2],["Zechariah",14],["Malachi",3],
    ["Psalms",150],["Proverbs",31],["Job",42],
    ["Shir HaShirim",8],["Ruth",4],["Eichah",5],["Kohelet",12],
    ["Esther",10],["Daniel",12],["Ezra",10],["Nechemia",13],
    ["Divrei HaYamim I",29],["Divrei HaYamim II",36]
  ];

  const TANACH_FLAT = [];
  for (const [name, chs] of TANACH_TRACTATES)
    for (let c = 1; c <= chs; c++) TANACH_FLAT.push([name, c]);

  function getMishnaInfo(d) {
    const dayNum = (d % 7 == 0) ? 7 : d % 7;
    const week   = (d % 7 == 0) ? Math.floor(d/7) : Math.floor(d/7) + 1;
    const day    = dayNum;
    if (day <= 5) {
      // Mishna: days 1-5, 2 chapters per day
      const weeksComplete = week - 1;
      const mishnaDayNum = weeksComplete * 5 + day;
      const idx = (mishnaDayNum - 1) * 2;
      const ch1 = MISHNA_FLAT[idx % MISHNA_FLAT.length];
      const ch2 = MISHNA_FLAT[(idx + 1) % MISHNA_FLAT.length];
      const sameBook = ch1[0] === ch2[0];
      return {
        type: 'mishna',
        week, day,
        text: sameBook
          ? `<strong>${ch1[0]}</strong> ${ch1[1]} & ${ch2[1]}`
          : `<strong>${ch1[0]}</strong> ${ch1[1]} &amp; <strong>${ch2[0]}</strong> ${ch2[1]}`,
        sub: `Seder ${getMishnaSeder(ch1[0])}`,
        tag1: ch1[0], tag2: `Week ${week} · Day ${day}`
      };
    } else {
      // Tosefta: days 6-7, 4 chapters per day
      const weeksComplete = week - 1;
      const toseftaDayNum = weeksComplete * 2 + (day - 5); // 1 or 2
      const idx = (toseftaDayNum - 1) * 4;
      const chs = [0,1,2,3].map(i => TOSEFTA_FLAT[(idx+i) % TOSEFTA_FLAT.length]);
      // Group by tractate
      const first = chs[0], last = chs[3];
      const sameBook = chs.every(c => c[0] === first[0]);
      return {
        type: 'tosefta',
        week, day,
        text: sameBook
          ? `Tosefta <strong>${first[0]}</strong> ${chs.map(c=>c[1]).join(', ')}`
          : `Tosefta <strong>${first[0]}</strong> ${first[1]}–… &amp; <strong>${last[0]}</strong> …${last[1]}`,
        sub: `Tosefta — the expanded Oral Torah`,
        tag1: 'Tosefta · ' + first[0], tag2: `Week ${week} · Day ${day}`
      };
    }
  }

  function getMishnaSeder(tractate) {
    const sedarim = {
      "Brachot":"Zeraim","Peah":"Zeraim","Demai":"Zeraim","Kilayim":"Zeraim",
      "Shvi'it":"Zeraim","Trumot":"Zeraim","Maasrot":"Zeraim","Maaser Sheni":"Zeraim",
      "Chalah":"Zeraim","Orlah":"Zeraim","Bikkurim":"Zeraim",
      "Shabat":"Moed","Eruvin":"Moed","Pesachim":"Moed","Shekalim":"Moed",
      "Yoma":"Moed","Sukkah":"Moed","Beitzah":"Moed","Rosh Hashana":"Moed",
      "Taanit":"Moed","Megillah":"Moed","Moed Katan":"Moed","Chagigah":"Moed",
      "Yevamot":"Nashim","Ketubot":"Nashim","Nedarim":"Nashim","Nazir":"Nashim",
      "Sotah":"Nashim","Gittin":"Nashim","Kiddushin":"Nashim",
      "Bava Kama":"Nezikin","Bava Metzia":"Nezikin","Bava Batra":"Nezikin",
      "Sanhedrin":"Nezikin","Makkot":"Nezikin","Shvuot":"Nezikin",
      "Eduyot":"Nezikin","Avodah Zarah":"Nezikin","Avot":"Nezikin","Horayot":"Nezikin",
      "Zevachim":"Kodashim","Menachot":"Kodashim","Chulin":"Kodashim","Bechorot":"Kodashim",
      "Erchin":"Kodashim","Temurah":"Kodashim","Keritut":"Kodashim","Me'ilah":"Kodashim",
      "Tamid":"Kodashim","Midot":"Kodashim","Kinim":"Kodashim",
      "Kelim":"Taharot","Ohalot":"Taharot","Nega'im":"Taharot","Parah":"Taharot",
      "Taharot":"Taharot","Mikva'ot":"Taharot","Niddah":"Taharot","Machshirim":"Taharot",
      "Zavim":"Taharot","Tevul Yom":"Taharot","Yadayim":"Taharot","Uktzin":"Taharot"
    };
    return sedarim[tractate] || '';
  }

  function getTanachInfo(d) {
    const dayNum = (d % 7 == 0) ? 7 : d % 7;
    const week   = (d % 7 == 0) ? Math.floor(d/7) : Math.floor(d/7) + 1;
    const day    = dayNum;
    const idx = (d - 1) * 2;
    const ch1 = TANACH_FLAT[idx % TANACH_FLAT.length];
    const ch2 = TANACH_FLAT[(idx + 1) % TANACH_FLAT.length];
    const sameBook = ch1[0] === ch2[0];
    const tanachSection = getTanachSection(ch1[0]);
    return {
      week, day,
      text: sameBook
        ? `<strong>${ch1[0]}</strong> ${ch1[1]} & ${ch2[1]}`
        : `<strong>${ch1[0]}</strong> ${ch1[1]} &amp; <strong>${ch2[0]}</strong> ${ch2[1]}`,
      sub: tanachSection,
      tag1: ch1[0], tag2: `Week ${week} · Day ${day}`
    };
  }

  function getTanachSection(book) {
    const nevi = ["Joshua","Judges","Shmuel I","Shmuel II","Kings I","Kings II",
                  "Isaiah","Jeremiah","Ezekiel","Hoshea","Joel","Amos","Obadiah",
                  "Yonah","Micha","Nachum","Habakkuk","Tzefanaiah","Chaggai","Zechariah","Malachi"];
    const writings = ["Psalms","Proverbs","Job","Shir HaShirim","Ruth","Eichah",
                      "Kohelet","Esther","Daniel","Ezra","Nechemia",
                      "Divrei HaYamim I","Divrei HaYamim II"];
    if (nevi.includes(book)) {
      return ["Joshua","Judges","Shmuel I","Shmuel II","Kings I","Kings II"].includes(book)
        ? "Nevi'im Rishonim — Early Prophets"
        : "Nevi'im Acharonim — Later Prophets";
    }
    return "Ketuvim — Sacred Writings";
  }

  // ── SHOVAVIM / PARASHA DATA (from blog) ──
  // ── EXACT CALCULATION ENGINE (from kabbalahoftime.com blog) ──
  const DATE_FROM_API = "2025-08-20T21:00:00Z";
  const DAY_OFFSET = 29;

  let currentOffset = 0;

  const MONTHS = ['January','February','March','April','May','June',
                  'July','August','September','October','November','December'];
  const DAYS_OF_WEEK = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

  const DAILY_TEXTS = [
    'Keter Shem Tov',           // Sunday
    'Noam Elimelech',           // Monday
    'Tanya',                    // Tuesday
    'Likutei Moharan',          // Wednesday
    'Mesilat Yesharim',         // Thursday
    'Zohar / Kitvei Arizal',    // Friday
    "Rebbe's Sichos & Maamarim" // Shabbat
  ];

  const TEXT_AUTHORS = [
    'Baal Shem Tov · Chesed · Foundational Chassidus',
    'Reb Elimelech of Lizhensk · Gevurah · Polish Chassidus',
    'Alter Rebbe · Tiferet · Chabad Philosophy',
    'Rebbe Nachman of Breslov · Netzach · Story & Depth',
    'Ramchal · Hod · Mussar & Character',
    'Rashbi / Arizal · Yesod · Kabbalistic Foundation',
    "The Lubavitcher Rebbe · Malchut · Contemporary Chassidus"
  ];

  const MIVTZOYIM = [
    'Shabbat Candles',
    'Kashrut',
    'Home Filled with Torah Books',
    'Education',
    'Tzedakah',
    'Tefillin',
    'Mezuzah',
    'Ahavat Yisrael',
    'Taharat HaMishpachah'
  ];

  // Map each of the 9 Mivtzoyim cycles to commandments 1-9
  const CYCLE_COMMANDMENTS = [
    { cycle: 1, mivtzah: 'Shabbat Candles',             commandment: 'I Am the Lord',              theme: 'Divine Closeness' },
    { cycle: 2, mivtzah: 'Kashrut',                     commandment: 'No Other Gods',              theme: 'Worldly Interaction' },
    { cycle: 3, mivtzah: 'Home Filled with Torah Books', commandment: 'Not to Profane G-d\'s Name', theme: 'Holiness Above Nature' },
    { cycle: 4, mivtzah: 'Education',                   commandment: 'The Sabbath',                theme: 'Holiness in Nature' },
    { cycle: 5, mivtzah: 'Tzedakah',                    commandment: 'Honor Parents',              theme: 'Jewish Connection' },
    { cycle: 6, mivtzah: 'Tefillin',                    commandment: 'Do Not Murder',              theme: 'Refining the Divine Image' },
    { cycle: 7, mivtzah: 'Mezuzah',                     commandment: 'Faithfulness',               theme: 'Marriage to Hashem' },
    { cycle: 8, mivtzah: 'Ahavat Yisrael',              commandment: 'Do Not Steal',               theme: 'Human Dignity / Baseless Love' },
    { cycle: 9, mivtzah: 'Taharat HaMishpachah',        commandment: 'Truth / No False Witness',   theme: 'Testifying/Confessing' }
  ];

  const TEN_COMMANDMENTS = [
    { num: 1,  commandment: 'I Am the Lord',              theme: 'Divine Closeness' },
    { num: 2,  commandment: 'No Other Gods',              theme: 'Worldly Interaction' },
    { num: 3,  commandment: 'Not to Profane G-d\'s Name', theme: 'Holiness Above Nature' },
    { num: 4,  commandment: 'The Sabbath',                theme: 'Holiness in Nature' },
    { num: 5,  commandment: 'Honor Parents',              theme: 'Jewish Connection' },
    { num: 6,  commandment: 'Do Not Murder',              theme: 'Refining the Divine Image' },
    { num: 7,  commandment: 'Faithfulness',               theme: 'Marriage to Hashem' },
    { num: 8,  commandment: 'Do Not Steal',               theme: 'Human Dignity / Baseless Love' },
    { num: 9,  commandment: 'Truth / No False Witness',   theme: 'Testifying/Confessing' },
    { num: 10, commandment: 'Do Not Covet',               theme: 'Complete Trust in G-d' }
  ];

  // Exact daysDiff from blog — mirrors Math.round(microDiff/ms_per_day - 28)
  function getDaysDiff(offsetDays) {
    const apiTime = (new Date(DATE_FROM_API)).getTime();
    const now = new Date();
    now.setDate(now.getDate() + offsetDays);
    const microDiff = Math.abs(apiTime - now.getTime());
    return Math.round(microDiff / (1000 * 60 * 60 * 24) - DAY_OFFSET);
  }

  function getDisplayDate(offsetDays) {
    const d = new Date();
    d.setDate(d.getDate() + offsetDays);
    return d;
  }

  // Sefirot label — exact logic from blog (handles day/week boundary edge cases)
  function getSefirotInfo(d) {
    const sevenDayCycle = 1 + parseInt(d / 7);
    const sevenWeekCycle = 1 + parseInt(sevenDayCycle / 7);

    const dayNames  = ['Malchut','Chesed','Gevurah','Tiferet','Netzach','Hod','Yesod'];
    const dayNamesD0 = ['Yesod','Malchut','Chesed','Gevurah','Tiferet','Netzach','Hod'];
    const dayNamesW0 = ['Yesod','Malchut','Chesed','Gevurah','Tiferet','Netzach','Hod'];

    const daySef   = dayNames[d % 7];
    const weekSef  = (d % 7 != 0) ? dayNames[sevenDayCycle % 7] : dayNamesD0[sevenDayCycle % 7];
    const cycleSef = (sevenDayCycle % 7 != 0) ? dayNames[sevenWeekCycle % 7] : dayNamesW0[sevenWeekCycle % 7];

    const dayNum  = (d % 7 == 0) ? 7 : d % 7;
    const weekNum = (d % 7 == 0) ? parseInt(d / 7) : sevenDayCycle;

    return {
      label: `${daySef} shebe${weekSef} [shebe${cycleSef}]`,
      daySef, weekSef, cycleSef,
      dayNum, weekNum
    };
  }


  // ── HEBREW CALENDAR ──────────────────────────────────────────────────────────
  // Converts a Gregorian date to Hebrew date.
  // Uses the Molad-based fixed arithmetic calendar (Dershowitz & Reingold).

  function hebrewLeapYear(y) { return ((7 * y + 1) % 19) < 7; }
  function hebrewElapsedDays(y) {
    const mE = Math.floor((235 * y - 234) / 19);
    const p  = 12084 + 13753 * mE;
    let day  = mE * 29 + Math.floor(p / 25920);
    if ((3 * (day + 1)) % 7 < 3) day++;
    return day;
  }
  function hebrewYearDays(y) {
    return hebrewElapsedDays(y + 1) - hebrewElapsedDays(y);
  }
  function daysInHebMonth(m, y) {
    const yd = hebrewYearDays(y);
    if (m === 2) return (yd === 355 || yd === 385) ? 30 : 29;  // Cheshvan
    if (m === 3) return (yd === 353 || yd === 383) ? 29 : 30;  // Kislev
    if (m === 12 && !hebrewLeapYear(y)) return 29;             // Adar (non-leap)
    const ml = [0,30,29,30,29,30,29,30,29,30,29,30,29,29];
    return ml[m] || 29;
  }
  function gregToJDN(y, m, d) {
    const a = Math.floor((14 - m) / 12);
    const Y = y + 4800 - a, M = m + 12 * a - 3;
    return d + Math.floor((153 * M + 2) / 5) + 365 * Y + Math.floor(Y / 4)
           - Math.floor(Y / 100) + Math.floor(Y / 400) - 32045;
  }
  // Reference: 1 Tishrei 5786 = JDN 2460942 (civil day Sep 23; night of Sep 22 begins the date)
  const HEB_EPOCH_DIFF = 2460942 - hebrewElapsedDays(5786) + 1;

  function gregToHebrew(gregDate) {
    // Convert Gregorian date to Hebrew date.
    // Uses JDN anchor: 1 Tishrei 5786 = Sep 22 2025 = JDN 2460941
    // Chabad convention: Hebrew date shown is the one active at NOON on the civil date
    // (i.e., the daytime portion). dayOfYear is 0-indexed from 1 Tishrei.
    const jdn = gregToJDN(gregDate.getFullYear(), gregDate.getMonth() + 1, gregDate.getDate());
    const RH_5786_JDN = 2460942; // 1 Tishrei 5786 = Sep 23 2025 (calendar day after sunset Sep 22)
    const HED_5786 = hebrewElapsedDays(5786);
    // Map JDN to Hebrew year
    let hy = 5786;
    let rhJDN = RH_5786_JDN;
    // Adjust year forward
    while (jdn >= rhJDN + hebrewYearDays(hy)) {
      rhJDN += hebrewYearDays(hy);
      hy++;
    }
    // Adjust year backward
    while (jdn < rhJDN) {
      hy--;
      rhJDN -= hebrewYearDays(hy);
    }
    // dayOfYear: 0 = 1 Tishrei, 1 = 2 Tishrei, etc.
    const dayOfYear = jdn - rhJDN;
    // Walk months to find day
    const lastM = hebrewLeapYear(hy) ? 13 : 12;
    const monthOrder = [7,8,9,10,11,12,13,1,2,3,4,5,6];
    let counted = 0;
    for (const hm of monthOrder) {
      if (hm === 13 && !hebrewLeapYear(hy)) continue;
      const ml = daysInHebMonth(hm, hy);
      if (dayOfYear < counted + ml) {
        return { year: hy, month: hm, day: dayOfYear - counted + 1,
                 monthDays: ml, leapYear: hebrewLeapYear(hy) };
      }
      counted += ml;
    }
    return { year: hy, month: 6, day: 29, monthDays: 29, leapYear: false };
  }

  const HEB_MONTH_NAMES = ['','Nissan','Iyar','Sivan','Tammuz','Av','Elul',
                            'Tishrei','Cheshvan','Kislev','Tevet','Shvat',
                            'Adar','Adar II'];

  // ── HEBREW NUMERALS (Gematria) ────────────────────────────────────────────────
  // Converts an integer to Hebrew letter notation (e.g. 24 → כ״ד, 5786 → תשפ״ו)
  function toHebrewNumerals(n) {
    const thousands = Math.floor(n / 1000);
    let rem = n % 1000;
    // Standard substitutions: 15→טו, 16→טז (avoid י-ה = G-d's name)
    const vals = [400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1];
    const lets = ['ת','ש','ר','ק','צ','פ','ע','ס','נ','מ','ל','כ','י','ט','ח','ז','ו','ה','ד','ג','ב','א'];
    // Substitute 15 and 16
    let parts = [];
    if (rem >= 16) {
      // normal decomposition
    } else if (rem === 16) { parts = ['ט','ז']; rem = 0; }
    else if (rem === 15) { parts = ['ט','ו']; rem = 0; }
    for (let i = 0; i < vals.length && rem > 0; i++) {
      while (rem >= vals[i]) { parts.push(lets[i]); rem -= vals[i]; }
    }
    // Add geresh / gershayim
    let result = '';
    if (thousands > 0) {
      // Thousands: single letter + geresh (usually omitted for years in same millennium)
      // For years 5700-5999 we show just the last 3 digits with geresh notation
    }
    if (parts.length === 1) {
      result = parts[0] + '׳';
    } else if (parts.length > 1) {
      result = parts.slice(0, -1).join('') + '״' + parts[parts.length - 1];
    }
    return result;
  }

  function toHebrewYear(y) {
    // Show year without thousands (common convention: 5786 → תשפ״ו)
    return toHebrewNumerals(y % 1000);
  }

  function formatHebrewDate(day, monthNum, year) {
    const HEB_MONTH_HEB = ['','נִיסָן','אִיָּר','סִיוָן','תַּמּוּז','אָב','אֱלוּל',
                           'תִּשְׁרֵי','חֶשְׁוָן','כִּסְלֵו','טֵבֵת','שְׁבָט','אֲדָר','אֲדָר ב׳'];
    const dayHeb   = toHebrewNumerals(day);
    const monthHeb = HEB_MONTH_HEB[monthNum] || '';
    const yearHeb  = toHebrewYear(year);
    return `${dayHeb} ${monthHeb} ${yearHeb}`;
  }

  // ── HAYOM YOM ────────────────────────────────────────────────────────────────
  // Key entries embedded; others link live to Chabad.org
  const HAYOM_YOM = {
    // Tishrei
    "7-1":  "The shofar of Rosh Hashana wakes the soul from its slumber.",
    "7-10": "Yom Kippur — the soul stands pure before the Source of all purity.",
    "7-15": "Sukkot — we dwell in the shade of faith.",
    "7-22": "Simchat Torah — the Torah's joy has no end.",
    // Cheshvan
    "8-1":  "Learning Torah for its own sake brings a person to love G-d.",
    "8-15": "One who recites Tehillim with concentration merits to see the Shechina.",
    // Kislev
    "9-19": "Yud-Tet Kislev — the Rosh Hashana of Chassidus.",
    // Tevet
    "10-10":"A leader of Israel carries the people's burden on his shoulders.",
    // Shvat
    "11-2": "The essential thing is the deed — the thought must lead to action.",
    "11-10":"Yud Shvat — connect to the root, and the branch will flourish.",
    "11-15":"Tu BiShvat — the new year of trees; the soul too has its seasons.",
    "11-24":"If you only knew the power of verses of Tehillim — you would recite them constantly.",
    "11-25":"Study Chumash with Rashi daily, say Tehillim — be scrupulous about each of these.",
    // Adar
    "12-7": "On the 7th of Adar, Moshe was born — and returned his soul on the same day.",
    "12-14":"Purim — joy breaks all boundaries.",
    // Nissan
    "1-14": "The night of Pesach — the world trembles with redemption.",
    // Iyar
    "2-18": "Lag BaOmer — the passing of R' Shimon bar Yochai illuminates the world.",
    // Sivan
    "3-6":  "Shavuot — at Sinai every Jew stood present, and stands present still.",
    // Tammuz
    "4-3":  "The Alter Rebbe was released on the 3rd of Tammuz — the Torah is eternal.",
    "4-12": "One who truly loves a fellow Jew also loves G-d.",
    // Av
    "5-9":  "Tisha B'Av — from the depths of exile comes the seed of redemption.",
    "5-15": "Tu B'Av — love and joy shall yet fill the world.",
    // Elul
    "6-18": "The King is in the field — G-d draws near to every soul in Elul.",
    "6-25": "The world was created on 25 Elul — creation begins with a single point.",
  };

  function getHayomYom(hm, hd) {
    return HAYOM_YOM[`${hm}-${hd}`] || null;
  }

  // ── LIKUTEI MOHARAN THEMES ───────────────────────────────────────────────────
  const LM_THEMES = {
    // ELUL (25-29) - Lessons 1-5
    1:   { theme: 'Torah & Prayer',            summary: 'Through Torah study, prayer rises and is accepted. Connect to the intellect in Creation to reach Hashem.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.1' },
    2:   { theme: 'Prayer & the Covenant',     summary: 'Prayer is Mashiach\'s weapon. Guard the covenant to pray properly and connect to true tzadikim.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.2' },
    3:   { theme: 'Song & Holiness',           summary: 'Listening to kosher singers is beneficial. Study Oral Torah at night to rectify improper song.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.3' },
    4:   { theme: 'World to Come Awareness',   summary: 'Knowing everything is for your benefit is the World to Come. Confess before a Torah scholar.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.4' },
    5:   { theme: 'Joy of Mitzvot',            summary: 'Joy of a mitzvah shatters barriers. The shofar straightens the heart and removes foreign thoughts.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.5' },
    // TISHREI (1-30) - Lessons 6-35
    6:   { theme: 'Self-Nullification',        summary: 'Minimize your honor, maximize G-d\'s honor. Be in constant Teshuva, judging others favorably.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.6' },
    7:   { theme: 'Faith (Emunah)',            summary: 'Exile stems from lack of faith. Emunah through truth and closeness to Tzadikim brings redemption.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.7' },
    8:   { theme: 'Sighs & Divine Breath',     summary: 'A Jewish sigh is precious. The Tzadik breathes life through mercy, winning atonement.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.8' },
    9:   { theme: 'Prayer Gates',              summary: 'Life force comes from prayer. Each tribe has its own gate; connect to the Tzadik to find yours.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.9' },
    10:  { theme: 'Clapping & Dancing',        summary: 'Clapping and dancing sweeten judgements. Draw close to Tzadikim to elevate prayer properly.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.10' },
    11:  { theme: 'Shema\'s Unifications',     summary: 'Bring about higher and lower unifications. Speech enlightens; guard the Brit to receive light of Teshuva.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.11' },
    12:  { theme: 'Tzadik vs. Demon Scholar',  summary: 'Jewish demon scholars attack Tzadikim. The Tzadik accepts with love and derives Torah from the attack.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.12' },
    13:  { theme: 'Breaking Desire for Money', summary: 'Full Divine providence requires breaking the desire for money. This brings kindness and knowledge.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.13' },
    14:  { theme: 'Torah of Kindness',         summary: 'Draw closer those outside holiness through Torah of kindness. Humility brings peace and prayer.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.14' },
    15:  { theme: 'Hidden Light & Fear',       summary: 'Elevate fear to its source to taste the Hidden Light. Judge yourself; prayer with humility is accepted.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.15' },
    16:  { theme: 'The Large Fish',            summary: 'Sometimes not engaging in Torah upholds it. References the great fish and future revelation.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.16' },
    17:  { theme: 'The Tzadik & Faith',        summary: 'Faith in the Tzadik is the root of all remedies. The Tzadik reveals Hashem\'s will and pride in Israel.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.17' },
    18:  { theme: 'Purpose & Mercy',           summary: 'Everything has a higher purpose leading to World to Come. Show mercy in anger to sweeten judgement.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.18' },
    19:  { theme: 'Traveling to the Tzadik',   summary: 'Travel to the Tzadik; learning from his face is unlike books. Guard Lashon HaKodesh to control desire.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.19' },
    20:  { theme: 'Words Like Coals',          summary: 'Torah revealed through suffering. Pour out your heart in prayer; words must be hot like coals.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.20' },
    21:  { theme: 'Shabbat Elevates All',      summary: 'Divine influx comes without introduction through sanctifying the senses. This is the Sukkah and Ruach HaKodesh.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.21' },
    22:  { theme: 'Seal Within a Seal',        summary: 'Rebuke seals harsh judgement. Fill hands with faith of the Seven Shepherds through holy boldness and joy.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.22' },
    23:  { theme: 'Joy Defeats Sadness',       summary: 'Shining face of holiness comes from faith in livelihood. Breaking desire for money brings life and light.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.23' },
    24:  { theme: 'Joy & Mitzvot',             summary: 'Doing mitzvot with joy elevates the Shechinah. Bring down blessing from all worlds through joy.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.24' },
    25:  { theme: 'Humility & Wisdom',         summary: 'Break imagination, elevate intellect. Tzedakah reveals Creator\'s greatness; joy subdues forces of impurity.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.25' },
    26:  { theme: 'Self-Sacrifice',            summary: 'The Tzadik elevates fallen sparks wherever external thoughts enter. Requires great self-sacrifice.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.26' },
    27:  { theme: 'Peace & Truth',             summary: 'World serving Hashem brings peace. Peace leads to truth through majestic countenance and song.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.27' },
    28:  { theme: 'Faith Like a Worm',         summary: 'Faith in sages defeats enemies. Invite righteous scholars; this is like bringing the daily Tamid offering.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.28' },
    29:  { theme: 'Praise of Tzadikim',        summary: 'Speech accepted when it has good through praise of Tzadikim. Guard clothing and purity to earn livelihood.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.29' },
    30:  { theme: 'The Proper Teacher',        summary: 'G-dliness grasped through contractions. Request a proper teacher; despise bribes to attain wisdom.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.30' },
    31:  { theme: 'Tzedakah & the Spheres',    summary: 'Tzedakah connected to celestial spheres. Emunah is the source of blessings; guard the Brit on journeys.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.31' },
    32:  { theme: 'Dancing at Weddings',       summary: 'Dancing at weddings mitigates judgements. Rectify the bride through joy of the heart brought to the legs.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.32' },
    33:  { theme: 'Pursue Peace',              summary: 'Pursue peace between people and within yourself. Accept everything from G-d; find Him in all materiality.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.33' },
    34:  { theme: 'Yosef the Ruler',           summary: 'The Tzadik awakens Jews to service, removing disgrace. Each person has a special quality to shine.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.34' },
    35:  { theme: 'Guarding Wisdom',           summary: 'Return everything to its source in Chochmah. Guard wisdom from external concepts; renew through \'sleep.\'',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.35' },
    // CHESHVAN (1-30) - Lessons 36-65
    36:  { theme: 'Seventy Souls',             summary: 'Every Jewish soul rooted in 70 souls of Yaakov. Exile brings 70 screams, then Torah revelation.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.36' },
    37:  { theme: 'Essence of Creation',       summary: 'Know Him through subordinating physicality. Fast, give Tzedakah, stay connected to Torah when earning a living.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.37' },
    38:  { theme: 'Tefilin & Glory',           summary: 'Tefilin represents attachment to Hashem. Elevate speech through Torah learned in poverty and distress.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.38' },
    39:  { theme: 'Breaking Hunger',           summary: 'Break the urge for eating. Sanctity in marital relations elevates and blesses the week.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.39' },
    40:  { theme: 'Journeys & Faith',          summary: 'All journeys result from blemished Emunah. Perfect faith means Hashem can provide without travel.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.40' },
    41:  { theme: 'Elevating the Heels',       summary: 'Bring Gevurot of Binah to the legs. Dance and joy from holiness sweetens judgements at their roots.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.41' },
    42:  { theme: 'Song Mitigates Judgement',  summary: 'Through song, judgements are mitigated. Believe in the sages; provide garments to the Tzadik.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.42' },
    43:  { theme: 'Da\'at of Holiness',        summary: 'Wicked person\'s Da\'at engenders immorality. Learn to make vessels kosher when conquering the world.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.43' },
    44:  { theme: 'Clapping Purifies Air',     summary: 'Clapping during prayer purifies the air. Removes killing and destruction, connecting to Avraham.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.44' },
    45:  { theme: 'Wings of the Lungs',        summary: 'Clapping arouses the lungs and speech. Develops the mouth through the aspects of Exodus and jubilee.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.45' },
    46:  { theme: 'Union & Memory',            summary: 'Clapping mitigates judgement, activates memory. Brings right and left together, eliminating strife.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.46' },
    47:  { theme: 'Breaking Desire for Food',  summary: 'Breaking desire for food brings truth and wealth. Praise Hashem for bounty to renew Heaven and Earth.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.47' },
    48:  { theme: 'Strength in Prayer',        summary: 'Say words of Torah and prayer with strength. This corresponds to the Sukkah and the 28 letters of Creation.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.48' },
    49:  { theme: 'Revelation of Malchut',     summary: 'Hashem\'s Malchut revealed through Middot. Sanctify thoughts; prayer erects Malchut and elevates Jerusalem.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.49' },
    50:  { theme: 'Waters of Sweetness',       summary: 'Guarding the Brit brings sweetness in prayer. Blemishing it brings bitterness like a dog consuming prayers.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.50' },
    51:  { theme: 'Pure Marble',               summary: 'Falsehood damages eyes. Don\'t say \'Water, Water\' in spiritual realms; distance from falsehood brings purity.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.51' },
    52:  { theme: 'Self-Nullification Through Prayer', summary: 'The world is not necessary existence; only Hashem is. Achieve self-nullification through Hitbodedut at night.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.52' },
    53:  { theme: 'Da\'at Brings Children',    summary: 'Ability to have children depends on complete Da\'at. Bring others close to Hashem to expand your Da\'at.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.53' },
    54:  { theme: 'Guard Your Memory',         summary: 'Guard memory of the World to Come. Understand daily hints but serve mainly through Torah and Mitzvot.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.54' },
    55:  { theme: 'Land of Israel & Justice',  summary: 'See downfall of wicked through Land of Israel. Find merit in the wicked to create protective shade.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.55' },
    56:  { theme: 'Kingship & Da\'at',         summary: 'Each person has Malchut, revealed and hidden. Use it for Hashem\'s will; Torah brings measured vitality.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.56' },
    57:  { theme: 'Faith in the Sages',        summary: 'Blemishing faith in sages has no cure. Connect to Yaakov; delight in Shabbat brings peace beyond fasting.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.57' },
    58:  { theme: 'Moshe\'s Double Portion',   summary: 'Well, Clouds, and Mannah given in Moshe\'s merit. Fight Amalek; fix the Brit to merit double portion.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.58' },
    59:  { theme: 'Building Holy Chambers',    summary: 'Bringing others close builds holy chambers. Guard against their impurity through judgement and angelic fire.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.59' },
    60:  { theme: 'Shabbat & Livelihood',      summary: 'Shabbat provides sustenance for the coming week. Honoring it brings abundant livelihood.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.60' },
    // SHEVAT (1-30) - Lessons 123-152
    123: { theme: 'Binding to the Tzadik',     summary: 'Bind yourself to the Tzadik, accepting his words without veering. Cast off pseudo-wisdoms and be simple and upright.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.123' },
    124: { theme: 'Victory in Prayer',         summary: 'Hashem takes pleasure when we "win" Him in prayer. He provides the words we need to be victorious.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.124' },
    125: { theme: 'Three Shabbat Meals',       summary: 'Eat three meals on Shabbat for that specific day. Shabbat eating is precious, corresponding to World to Come delight.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.125' },
    126: { theme: 'Missing the Tzadik',        summary: 'The Tzadik is like Shabbat. One misses the Tzadik before his passing, as one misses the extra soul after Shabbat.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.126' },
    127: { theme: 'Honorable Clothing',        summary: 'Clothes serve as protection and should be whole. Honor your clothes; they make claims if dishonored.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.127' },
    128: { theme: 'Guarding the Eyes',         summary: 'The Sages blinded evil inclination for sexual desire. Lower your eyes completely, not just from the side.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.128' },
    129: { theme: 'Faith Transforms',          summary: 'Faith in the Tzadik transforms you to be part of him, like consumed food becomes part of the eater.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.129' },
    130: { theme: 'Humility Guards Covenant',  summary: 'Humility leads to salvation from sexual immorality. Moshe exemplifies ultimate humility and guarding the Covenant.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.130' },
    131: { theme: 'Fear of Honor',             summary: 'Be afraid of honor—it is life-threatening. Glory is kingship which judges.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.131' },
    132: { theme: 'Hidden Springs',            summary: 'A Tzadik may be famous in one land, unknown in another. Like a spring that waters tree roots underground.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.132' },
    133: { theme: 'The Tzadik as Sun',         summary: 'The Tzadik illuminates constantly like the sun; the world blocks us from seeing Torah\'s greatness. Seek higher perspective.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.133' },
    134: { theme: 'Speaking Torah',            summary: 'Speaking Torah publicly is a major endeavor. Weigh words carefully; inappropriate words resemble wasting seed.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.134' },
    135: { theme: 'Honoring Holidays',         summary: 'Escape haughtiness by honoring Yamim Tovim with joy. Yom Tov connects to Binah and brings humility.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.135' },
    136: { theme: 'Judging Favorably',         summary: 'Judge your companion favorably during disputes, whether they are higher or lower than you.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.136' },
    137: { theme: 'G-dly Portion',             summary: 'Your G-dly portion tells you to keep Hashem\'s words. Give tithes as commanded.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.137' },
    138: { theme: 'Heart as Emissary',         summary: 'The heart becomes Hashem\'s emissary. With a pure heart, it speaks His words literally.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.138' },
    139: { theme: 'Shabbat Returns Mitzvot',   summary: 'Shabbat returns the "feet" of weekday Mitzvot to holiness. Like a father delighting in his child\'s first steps.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.139' },
    140: { theme: 'Tzadik as Seal',            summary: 'A Tzadik is understood through those close to him. He is a seal because he guards the Covenant.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.140' },
    141: { theme: 'Circumcising the Heart',    summary: 'Circumcise your heart to feel pain over sins. When you feel remorse, your fallen seed feels it too.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.141' },
    142: { theme: 'Study from the Heart',      summary: 'If you cannot study but your heart burns with desire, this is studying from the Book of Remembrance.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.142' },
    143: { theme: 'Accepting Wise Advice',     summary: 'Accepting advice from the wise sweetens judgement. Expands constricted mind. Even if things don\'t work out, it was from Heaven.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.143' },
    144: { theme: 'Always Serving Hashem',     summary: 'For a Tzadik, no difference between life and death—always serving Hashem. Conquers desires even on permitted days.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.144' },
    145: { theme: 'Restraining Strife',        summary: 'Restraining desire for strife is like not dying. Being quoted in Halacha keeps one alive.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.145' },
    146: { theme: 'Torah\'s Female Quality',   summary: 'Torah uses female quality to provide testimony where men don\'t go. Enlightens the foolish pursuing lusts.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.146' },
    147: { theme: 'Holy Boldness',             summary: 'Need holy boldness from Hashem to overcome obstacles. Must temper boldness so it doesn\'t become brazenness.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.147' },
    148: { theme: 'Fear Itself Fears',         summary: 'Fear of Hashem itself fears Hashem, and that fear also fears, continuing indefinitely. Heel of humility, head of wisdom.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.148' },
    149: { theme: 'Tikkun Chatzot',            summary: 'Midnight prayer works as redemption. Darkest time when night starts getting lighter. Two-hour window after sixth hour from nightfall.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.149' },
    150: { theme: 'Hidden Test',               summary: 'Yaakov\'s appearance to Yosef during his test is deeply hidden. That it remained difficult even after is covered and hidden.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.150' },
    151: { theme: 'Healing Infants',           summary: 'Recite Rosh Chodesh verse to have children or heal infants. Relates to fixing the moon\'s blemish and Moshe\'s completion.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.151' },
    152: { theme: 'Opening of Faith',          summary: 'Soul surrounded by impurity except for opening of faith. Blemishes seal it. G-d-fearing guards it. Self-sacrifice connects to Tzadik.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.152' },
    // ADAR (1-29) - Lessons 153-181
    153: { theme: 'Greeting Torah Scholar',    summary: 'Disciple must be like polished mirror to receive Torah scholar\'s light. Cannot be thick with lust or brazenness.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.153' },
    154: { theme: 'Fallen Fears',              summary: 'Suffering comes from fallen fears. Elevate fears to their root. Judge yourself; then no judgement above and no need to fear anything except Hashem.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.154' },
    155: { theme: 'Joy Through Faith',         summary: 'Sadness prevents traveling to Tzadik and proper prayer. Faith in Hashem listening gives power to grow and overcome with joy.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.155' },
    156: { theme: 'Hitbodedut as Ruach HaKodesh', summary: 'Private conversation with Hashem is holy spirit. Renew words each time. Purify heart through flames of desire for Hashem.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.156' },
    157: { theme: 'Ultimate Desire',           summary: 'Cleaving to Torah words from a Tzadik\'s mouth makes one wonder how anyone desires this world\'s life.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.157' },
    158: { theme: 'Temporary Fires',           summary: 'Temporary burning desire to serve Hashem is like distant mist fires. Contrast with true desire from Tzadik\'s Torah.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.158' },
    159: { theme: 'Torah Fire & Water',        summary: 'Shechinah is intermediary. Torah has fire (spiritual) and water (physical). Not everyone merits Shechinah receiving their Torah.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.159' },
    160: { theme: 'Pulse & Speech',            summary: 'Pulse knocks, reminding to serve Hashem or to sin. Pulse follows speech; both go according to one\'s words.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.160' },
    161: { theme: 'Disputes Elevate',          summary: 'Disputes raise and elevate like water carrying a tree. See positive aspect of disagreement to avoid tragedy.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.161' },
    162: { theme: 'Wisdom & Wealth',           summary: 'Wealthy distinguished man opposed Maggid, became close through prayer. Became wise but lost wealth. Only humility allows both.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.162' },
    163: { theme: 'Speech Held Captive',       summary: 'Holy speech wants to emerge but can be trapped by impurity. Tzadik has power to free it. Person becomes conversation on people\'s mouths.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.163' },
    164: { theme: 'The Great Doctor',          summary: 'Doctor became ill, needed great doctor\'s special cures. Tzadik knows what spiritual cures each person needs.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.164' },
    165: { theme: 'Bad Within Us',             summary: 'When something bad happens, it\'s due to bad within us. Need Teshuvah.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.165' },
    166: { theme: 'Gathering Around Tzadik',   summary: 'Gather by the Tzadik to give him rulership. This grants power to annul decrees.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.166' },
    167: { theme: 'Shabbat Like Fasts',        summary: 'Shabbats spent with the true Torah scholar are like fasts. Spiritual elevation through time with Tzadik.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.167' },
    168: { theme: 'Haughtiness & Humility',    summary: 'Haughtiness indicates coming trouble. Lowliness/humility signs that great honor approaches.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.168' },
    169: { theme: 'Joy & Judgement',           summary: 'Dancing and joy, but also judgements brought by runners. Pregnancy is judgement; birth removes it. Judge yourself to bring joy.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.169' },
    170: { theme: 'Afflictions Elevate',       summary: 'Person suffers afflictions from those around. Greater person suffers from more. Afflictions subjugate body, releasing soul to elevate others.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.170' },
    171: { theme: 'Rising from Dust',          summary: 'Those rising from dust: use new Torah for eternal life or to mock—leading to eternal derision. Humility or ego determines path.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.171' },
    172: { theme: 'Nullifying Oneself',        summary: 'Become nothing before Hashem. Nullifying one\'s shade allows divine light to enter. Hashem\'s smile and Tzadikim\'s smile benefit the world.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.172' },
    173: { theme: 'Recognizing the Soul',      summary: 'Tzadik HaEmet recognizes from writing and speech the inner dimension of one\'s soul and root of faith.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.173' },
    174: { theme: 'Not Evoking Names',         summary: 'In time of judgement, don\'t evoke person\'s name. Moshe hints at Miriam\'s name through gematria when praying for her.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.174' },
    175: { theme: 'Crying from Joy',           summary: 'Essential crying is from joy and happiness. Even remorse should be from joy in Hashem.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.175' },
    176: { theme: 'Removing Foolishness',      summary: 'Spirit of folly fills heart with air. Connecting to Tzadik\'s hollow heart creates vacuum, removing foolishness and leaving humility.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.176' },
    177: { theme: 'Wine & Leadership',         summary: 'True Tzadikim pardon sin through occasional wine. Wine makes one a leader. Being content with G-d\'s will gives reign to His kingship.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.177' },
    178: { theme: 'Confession & Joy',          summary: 'Confess verbally. Turn to joy of mitzvot from head to toe. Many mitzvot overcome worry, enabling confession.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.178' },
    179: { theme: 'Fasting Resolves Strife',   summary: 'Strife resolved through fasting. Links one\'s will to Hashem\'s, reviving joy. Yom Kippur essence encompasses all days.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.179' },
    180: { theme: 'Pidyon - Redemption',       summary: 'Pidyon to Tzadik mitigates judgement. Money corresponds to feet/Malchut. Atonement through Binah.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.180' },
    181: { theme: 'United Glory',              summary: 'Group can unite their "glory" against someone greater. Wicked have no glory. Words against true Tzadik benefit him—they stand him up.',
           blog_url: 'https://www.kabbalahoftime.com/2024/03/rebbe-nachman-bkol-hashanah-liluy.html',
           url: 'https://www.sefaria.org/Likutei_Moharan.181' },
    //  Additional lessons from Nissan onwards can be added from the blog
    64:  { theme: 'Prayer Illuminates',        summary: 'Prayer offered with concentration and joy illuminates the world. The quality of one\'s prayer directly affects the spiritual light revealed.',
           url: 'https://www.sefaria.org/Likutei_Moharan.64' },
    282: { theme: 'Begin Again',               summary: 'The final teaching: it is never too late to begin again. No matter where one has fallen, G-d\'s hand is always extended in welcome.',
           url: 'https://www.sefaria.org/Likutei_Moharan.282' },
  };

  // ── DAF YOMI — Cycle 14 (Jan 5 2020 → July 7 2027) ──────────────────────────
  // Each entry: [days_since_Jan1_2020, tractate_name, hebrew_name, last_daf_number]
  // Daf on a given date = 2 + (days_since_epoch - tractate_start_day)
  const DAF_YOMI_CYCLE14 = [
    [4,    'Berakhot',     'בְּרָכוֹת',       64],
    [67,   'Shabbat',      'שַׁבָּת',          157],
    [223,  'Eruvin',       'עֵרוּבִין',        105],
    [327,  'Pesachim',     'פְּסָחִים',        121],
    [447,  'Shekalim',     'שְׁקָלִים',        22],
    [468,  'Yoma',         'יוֹמָא',           88],
    [555,  'Sukkah',       'סוּכָּה',          56],
    [610,  'Beitzah',      'בֵּיצָה',          40],
    [649,  'Rosh Hashanah','רֹאשׁ הַשָּׁנָה',   35],
    [683,  'Taanit',       'תַּעֲנִית',        31],
    [712,  'Megillah',     'מְגִלָּה',         32],
    [743,  'Moed Katan',   'מוֹעֵד קָטָן',     29],
    [772,  'Chagigah',     'חֲגִיגָה',         27],
    [798,  'Yevamot',      'יְבָמוֹת',         122],
    [919,  'Ketubot',      'כְּתֻבּוֹת',       112],
    [1030, 'Nedarim',      'נְדָרִים',         91],
    [1120, 'Nazir',        'נָזִיר',           66],
    [1185, 'Sotah',        'סוֹטָה',           49],
    [1233, 'Gittin',       'גִּטִּין',          90],
    [1322, 'Kiddushin',    'קִדּוּשִׁין',       82],
    [1403, 'Bava Kamma',   'בָּבָא קַמָּא',     119],
    [1521, 'Bava Metzia',  'בָּבָא מְצִיעָא',   119],
    [1639, 'Bava Batra',   'בָּבָא בַּתְרָא',   176],
    [1814, 'Sanhedrin',    'סַנְהֶדְרִין',      113],
    [1926, 'Makkot',       'מַכּוֹת',          24],
    [1949, 'Shevuot',      'שְׁבוּעוֹת',       49],
    [1997, 'Avodah Zarah', 'עֲבוֹדָה זָרָה',    76],
    [2071, 'Horayot',      'הוֹרָיוֹת',        14],
    [2085, 'Zevachim',     'זְבָחִים',         120],
    [2204, 'Menachot',     'מְנָחוֹת',         110],
    [2314, 'Chulin',       'חֻלִּין',          142],
    [2456, 'Bekhorot',     'בְּכוֹרוֹת',       61],
    [2516, 'Arakhin',      'עֶרְכִין',         34],
    [2550, 'Temurah',      'תְּמוּרָה',        34],
    [2584, 'Keritot',      'כְּרִיתוֹת',       28],
    [2612, 'Meilah',       'מְעִילָה',         22],
    [2634, 'Niddah',       'נִדָּה',           73],
  ];

  const DAF_EPOCH = new Date(2020, 0, 1); // Jan 1 2020

  function getDafYomi(civilDate) {
    const days = Math.floor((civilDate - DAF_EPOCH) / 86400000);
    for (let i = DAF_YOMI_CYCLE14.length - 1; i >= 0; i--) {
      const [startDay, name, heb, lastDaf] = DAF_YOMI_CYCLE14[i];
      if (days >= startDay) {
        const daf = 2 + (days - startDay);
        if (daf <= lastDaf) return { name, heb, daf };
        return null; // gap between tractates (shouldn't happen)
      }
    }
    return null;
  }

  function getLMLesson(hm, hd, hy) {
    // Count days from 25 Elul of the previous Hebrew year
    // Day 1 = 25 Elul; Elul has 29 days → days 1-5 = 25-29 Elul
    const elulDaysAfter25 = 29 - 25; // = 4, so days 1-5 (incl.)
    const monthOrder = [6,7,8,9,10,11,12,13,1,2,3,4,5]; // Elul first, then year
    const leapYear = hebrewLeapYear(hy);
    
    let lessonNum = 0;
    for (const m of monthOrder) {
      if (!leapYear && m === 13) continue;
      const ml = daysInHebMonth(m, hy);
      const startDay = (m === 6) ? 25 : 1; // Elul starts counting from day 25
      const daysInThisSlice = ml - startDay + 1;
      
      if (m === hm) {
        lessonNum += hd - startDay + 1;
        break;
      }
      lessonNum += daysInThisSlice;
    }
    // Wrap within ~354 (non-leap) or 383 (leap) day cycle
    const cycleLen = leapYear ? 383 : 354;
    lessonNum = ((lessonNum - 1) % cycleLen) + 1;
    return lessonNum;
  }

  // ── ALEF-BET DATA (22 sets × 2 letters each = 16.5 full sets in 364-day year) ──
  // Single letters for each day 1-22 within any cycle
  const SINGLE_LETTERS_22 = [
    { letter: 'Alef', hebrew: 'א' },      // Day 1
    { letter: 'Bet', hebrew: 'ב' },       // Day 2
    { letter: 'Gimmel', hebrew: 'ג' },    // Day 3
    { letter: 'Dalet', hebrew: 'ד' },     // Day 4
    { letter: 'Heh', hebrew: 'ה' },       // Day 5
    { letter: 'Vav', hebrew: 'ו' },       // Day 6
    { letter: 'Zayin', hebrew: 'ז' },     // Day 7
    { letter: 'Chet', hebrew: 'ח' },      // Day 8
    { letter: 'Tet', hebrew: 'ט' },       // Day 9
    { letter: 'Yud', hebrew: 'י' },       // Day 10
    { letter: 'Kaf', hebrew: 'כ' },       // Day 11
    { letter: 'Lamed', hebrew: 'ל' },     // Day 12
    { letter: 'Mem', hebrew: 'מ' },       // Day 13
    { letter: 'Nun', hebrew: 'נ' },       // Day 14
    { letter: 'Samech', hebrew: 'ס' },    // Day 15
    { letter: 'Ayin', hebrew: 'ע' },      // Day 16
    { letter: 'Peh', hebrew: 'פ' },       // Day 17
    { letter: 'Tzaddik', hebrew: 'צ' },   // Day 18
    { letter: 'Kuf', hebrew: 'ק' },       // Day 19
    { letter: 'Reish', hebrew: 'ר' },     // Day 20
    { letter: 'Shin', hebrew: 'ש' },      // Day 21
    { letter: 'Tav', hebrew: 'ת' }        // Day 22
  ];

  const ALEF_BET = [
    { letters: 'Alef & Bet', hebrew: 'א & ב', theme: 'Heavens & Earth', cycle: 1 },
    { letters: 'Gimmel & Dalet', hebrew: 'ג & ד', theme: 'Eden & Gehennom', cycle: 2 },
    { letters: 'Heh & Vav', hebrew: 'ה & ו', theme: 'Desert & Fields', cycle: 3 },
    { letters: 'Zayin & Chet', hebrew: 'ז & ח', theme: 'Waters & Seas', cycle: 4 },
    { letters: 'Tet & Yud', hebrew: 'ט & י', theme: 'Rivers & Wellsprings', cycle: 5 },
    { letters: 'Kaf & Lamed', hebrew: 'כ & ל', theme: 'Day & Night', cycle: 6 },
    { letters: 'Mem & Nun', hebrew: 'מ & נ', theme: 'Sun & Moon', cycle: 7 },
    { letters: 'Samech & Ayin', hebrew: 'ס & ע', theme: 'Stars & Constellations', cycle: 8 },
    { letters: 'Peh & Tzaddik', hebrew: 'פ & צ', theme: 'Clouds — Thick & Light', cycle: 9 },
    { letters: 'Kuf & Reish', hebrew: 'ק & ר', theme: 'Wind & Lightning', cycle: 10 },
    { letters: 'Shin & Tav', hebrew: 'ש & ת', theme: 'Dew & Rain', cycle: 11 },
    { letters: 'Kaf Sofit', hebrew: 'ך', theme: 'Trees & Vine', cycle: 12 },
    { letters: 'Mem Sofit', hebrew: 'ם', theme: 'Fig & Pomegranate', cycle: 13 },
    { letters: 'Nun Sofit', hebrew: 'ן', theme: 'Palm & Etrog', cycle: 14 },
    { letters: 'Peh Sofit', hebrew: 'ף', theme: 'Sheaves of Barley & Wheat', cycle: 15 },
    { letters: 'Tzadik Sofit', hebrew: 'ץ', theme: 'Sheaves & Vegetables', cycle: 16 },
    { letters: 'Vowels', hebrew: 'נקודות', theme: 'Vowels & Grass', cycle: 17 }
  ];

  // 22-day cycle — enriched
  function get22DayInfo(d) {
    const cycle = (d % 22 == 0) ? parseInt(d/22) : 1 + parseInt(d/22);
    const day   = (d % 22 == 0) ? 22 : d % 22;
    // Daily letter (1-22)
    const dailyLetter = SINGLE_LETTERS_22[day - 1];
    // Which cycle theme (0-indexed): each set is 22 days, 17 sets total
    const setIndex = Math.min(cycle - 1, ALEF_BET.length - 1);
    const ab = ALEF_BET[setIndex];
    return { 
      cycle, 
      day, 
      letters: ab.letters,        // Cycle letters (e.g., "Mem & Nun" for Set 7)
      hebrew: ab.hebrew,          // Cycle Hebrew
      theme: ab.theme,
      dailyLetter: dailyLetter.letter,      // Day letter (e.g., "Samech" for day 15)
      dailyHebrew: dailyLetter.hebrew       // Day Hebrew
    };
  }

  // 13-day cycle — enriched with 13 Attributes
  // Micha's 13 Attributes of Mercy (Micah 7:18-20)
  const THIRTEEN_ATTRIBUTES = [
    { num: 1,  name: 'Mi-El Kamocha', hebrew: 'מִי אֵ-ל כָּמוֹךָ', meaning: 'Who is a G-d like You (in compassion)' },
    { num: 2,  name: 'Noseh Avon', hebrew: 'נֹשֵׂא עָוֹן', meaning: 'Who bears iniquity' },
    { num: 3,  name: 'Ve\'over Al-Pesha', hebrew: 'וְעֹבֵר עַל פֶּשַׁע', meaning: 'And overlooks sin' },
    { num: 4,  name: 'Lish\'eirit Nachalato', hebrew: 'לִשְׁאֵרִית נַחֲלָתוֹ', meaning: 'For the remnant of His heritage' },
    { num: 5,  name: 'Lo Hechezik Le\'ad Apo', hebrew: 'לֹא הֶחֱזִיק לָעַד אַפּוֹ', meaning: 'He does not retain His anger forever' },
    { num: 6,  name: 'Ki Chafetz Chesed Hu', hebrew: 'כִּי חָפֵץ חֶסֶד הוּא', meaning: 'For He desires kindness' },
    { num: 7,  name: 'Yashuv Yerachamenu', hebrew: 'יָשׁוּב יְרַחֲמֵנוּ', meaning: 'He shall again have mercy on us' },
    { num: 8,  name: 'Yichbosh Avonoteinu', hebrew: 'יִכְבֹּשׁ עֲוֹנֹתֵינוּ', meaning: 'And suppresses our iniquities' },
    { num: 9,  name: 'Vetashlich Bimtzulot Yam', hebrew: 'וְתַשְׁלִיךְ בִּמְצֻלוֹת יָם', meaning: 'Casts our sins into the depths of the sea' },
    { num: 10, name: 'Titein Emet Le\'Yaakov', hebrew: 'תִּתֵּן אֱמֶת לְיַעֲקֹב', meaning: 'You grant truth to Jacob' },
    { num: 11, name: 'Chesed Le\'Avraham', hebrew: 'חֶסֶד לְאַבְרָהָם', meaning: 'Kindness to Abraham' },
    { num: 12, name: 'Asher Nishba\'ta La\'avoteinu', hebrew: 'אֲשֶׁר נִשְׁבַּעְתָּ לַאֲבֹתֵינוּ', meaning: 'Which You previously swore to our forefathers' },
    { num: 13, name: 'Mimei Kedem', hebrew: 'מִימֵי קֶדֶם', meaning: 'From the earliest days' }
  ];

  // Nassi (tribal prince) for each day 1-13 within a cycle (based on Rosh Chodesh Nissan order)
  const NASSI_NAMES = [
    'Nachshon ben Aminadav (Yehudah)',
    'Netanel ben Tzuar (Yissachar)',
    'Eliav ben Chelon (Zevulun)',
    'Elitzur ben Shedeur (Reuven)',
    'Shlumiel ben Tzurishaddai (Shimon)',
    'Elyasaf ben Deuel (Gad)',
    'Elishama ben Amihud (Ephraim)',
    'Gamliel ben Pedahtzur (Menashe)',
    'Avidan ben Gideoni (Binyamin)',
    'Achiezer ben Amishadai (Dan)',
    'Pagiel ben Ochran (Asher)',
    'Achira ben Einan (Naftali)',
    'Day 13 — Synthesis of All Tribes'
  ];

  function get13DayInfo(d) {
    const cycle = (d % 13 == 0) ? parseInt(d/13) : 1 + parseInt(d/13);
    const day   = (d % 13 == 0) ? 13 : d % 13;
    const attr  = THIRTEEN_ATTRIBUTES[day - 1];
    const nassi = NASSI_NAMES[day - 1];
    // Which set of 13: inner (Micah) = first half, outer (Moshe) = second half
    const setType = cycle <= 14 ? 'Inner — Attributes of Micah' : (cycle <= 26 ? 'Outer — Attributes of Moshe' : 'Inner & Outer — Combined');
    return { cycle, day, attr, nassi, setType };
  }

  // 41-day cycle — enriched
  function get41DayInfo(d) {
    const cycle = (d % 41 == 0) ? parseInt(d/41) : 1 + parseInt(d/41);
    const day   = (d % 41 == 0) ? 41 : d % 41;
    const mivtzah = MIVTZOYIM[Math.min(cycle - 1, 8)];
    let soulLevel;
    if (day == 41)      soulLevel = 'Yechidah / Adam Kadmon';
    else if (day <= 10) soulLevel = 'Nefesh / Assiyah';
    else if (day <= 20) soulLevel = 'Ruach / Yetzirah';
    else if (day <= 30) soulLevel = 'Neshamah / Beriah';
    else                soulLevel = 'Chayah / Atzilut';
    // Day within current soul-level (1-10)
    const levelStart = day == 41 ? 41 : (day <= 10 ? 1 : day <= 20 ? 11 : day <= 30 ? 21 : 31);
    const dayInLevel = day == 41 ? 1 : (day - levelStart + 1);
    // Commandment mapping within 41: day mod 10 (1-10 = 10 Commandments)
    const commandmentDay = day == 41 ? 10 : ((day - 1) % 10) + 1;
    return { cycle, day, mivtzah, soulLevel, dayInLevel, commandmentDay };
  }

  // Halacha — exact from blog (ch1 = d*2-1, ch2 = d*2)
  function getHalachaInfo(d) {
    const ch1 = d * 2 - 1;
    const ch2 = d * 2;
    if (ch1 > 697) return { chofetz: true, section: d - 348 };
    return { chofetz: false, ch1, ch2 };
  }

  // Daily text — tonight begins next Hebrew day so use tomorrow's weekday
  function getDailyText(date) {
    const tomorrow = new Date(date);
    tomorrow.setDate(tomorrow.getDate() + 1);
    const dow = tomorrow.getDay();
    return { name: DAILY_TEXTS[dow], author: TEXT_AUTHORS[dow], dayName: DAYS_OF_WEEK[dow] };
  }


  // ── 52-WEEK BOOK DATA (Books 1–7) ──
  // Book 1: Perek Shirah animals (Ch 4–6), Pirkei Avot rabbis (Ch 1–5), weekly themes
  // Book 2: 48 qualities to acquire Torah (Haazinu / II Samuel 22) + Prophets + Levitical Cities
  // Book 3: Book of Ruth genealogy (Perez → David) + Haftarot of Hannah + Daf Yomi (Sotah) 
  // Book 4: Proverbs chapters + Story of Channah (weekly verses)
  // Book 5: Song of Songs (weekly verses) + Jeremiah
  // Book 6: Psalms (weekly portions)
  // Book 7: Mesilat Yesharim chapters + parasha connection

  const WEEKLY_BOOKS = [
  // W1
  { week:1, parasha:'Rosh Hashana / Haazinu',   month:'Tishrei',
    b1_theme:   'Raise our Heads & Recognize G-d\'s Oneness',
    b1_animal:  'Rooster', b1_avot: 'Avot 1:1–3 — Men of the Great Assembly',
    b2_quality: 'Torah greater than priesthood and kingship',      b2_prophet: 'Avraham & Sarah',
    b3_ruth:    'Perez — breakthrough and new beginnings',          b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 1 — The beginning of wisdom is awe of G-d',
    b5_shir:    'Shir 1:1 — Let him kiss me with kisses of his mouth',
    b6_psalms:  'Ps 1–3 — Happy the man who walks not in counsel of the wicked',
    b7_mesilas: 'Intro — Man\'s purpose: to delight in G-d and enjoy His presence' },
  // W2
  { week:2, parasha:'Yom Kippur / Bereshit',    month:'Tishrei',
    b1_theme:   'Relate Well to Others and to Our Own Body',
    b1_animal:  'Hen', b1_avot: 'Avot 1:4–5 — Yossi ben Yoezer & Yossi ben Yochanan',
    b2_quality: 'Constant study',                                   b2_prophet: 'Yitzchak',
    b3_ruth:    'Hezron — the enclosed courtyard, entering deeper', b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 2 — If you seek it like silver, you will find knowledge of G-d',
    b5_shir:    'Shir 1:2–4 — Your oils have a goodly fragrance',
    b6_psalms:  'Ps 4–6 — O Lord, rebuke me not in Your anger',
    b7_mesilas: 'Ch 1 — Man\'s Duty in his World: clarify your purpose' },
  // W3
  { week:3, parasha:'Sukkot',                   month:'Tishrei',
    b1_theme:   'Be Happy, Balanced, and Secure in G-d',
    b1_animal:  'Dove', b1_avot: 'Avot 1:6–7 — Yehoshua ben Perachia & Nitai',
    b2_quality: 'Attentive listening (Shmiat haOzen)',             b2_prophet: 'Yaakov',
    b3_ruth:    'Ram — elevated, like the lulav raised on high',   b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 3 — Trust in G-d with all your heart',
    b5_shir:    'Shir 1:5–7 — I am dark but comely, O daughters of Jerusalem',
    b6_psalms:  'Ps 7–9 — O Lord our Master, how mighty is Your name',
    b7_mesilas: 'Ch 2 — Watchfulness (Zehirut): mindful awareness of all actions' },
  // W4
  { week:4, parasha:'Bereshit',                 month:'Tishrei',
    b1_theme:   'Take Responsibility Yet Protect Oneself',
    b1_animal:  'Turtledove', b1_avot: 'Avot 1:8–9 — Yehuda ben Tabbai & Shimon ben Shatach',
    b2_quality: 'Verbal enunciation',                              b2_prophet: 'Moshe',
    b3_ruth:    'Aminadav — my people are willing (Bereshit: free will)',
    b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 4 — Acquire wisdom, acquire understanding — do not forget',
    b5_shir:    'Shir 1:8–11 — If you do not know yourself, O fairest of women',
    b6_psalms:  'Ps 10–12 — Why do You stand afar, O Lord?',
    b7_mesilas: 'Ch 3 — Divisions of Watchfulness: intellectual and personal introspection' },
  // W5
  { week:5, parasha:'Noach',                    month:'Cheshvan',
    b1_theme:   'Use All Tools Available to Elevate the World',
    b1_animal:  'Eagle', b1_avot: 'Avot 1:10–11 — Shemayah & Avtalyon',
    b2_quality: 'Perception of the heart (Binat HaLev)',           b2_prophet: 'Aharon',
    b3_ruth:    'Nachshon — he who dove in first (Noach: first to build)',
    b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 5 — Beware the strange woman; her lips drip honey',
    b5_shir:    'Shir 1:12–14 — While the king was at his table, my spikenard gave its fragrance',
    b6_psalms:  'Ps 13–15 — Who shall dwell on Your holy mountain?',
    b7_mesilas: 'Ch 4 — Acquiring Watchfulness through self-reflection and Torah' },
  // W6
  { week:6, parasha:'Lech Lecha',               month:'Cheshvan',
    b1_theme:   'Impact the World, Laying a Foundation',
    b1_animal:  'Crane (Agur)', b1_avot: 'Avot 1:12–13 — Hillel & Shammai',
    b2_quality: 'Awe (Eimah)',                                     b2_prophet: 'Yehoshua',
    b3_ruth:    'Salmon — garment, protection (Lech Lecha: Avraham\'s journey)',
    b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 6 — Go to the ant, you sluggard; consider its ways',
    b5_shir:    'Shir 1:15–17 — Behold you are beautiful, my beloved',
    b6_psalms:  'Ps 16–18 — I have set G-d before me always',
    b7_mesilas: 'Ch 5 — Obstacles to Watchfulness: frivolity, bad company, worldliness' },
  // W7
  { week:7, parasha:'Vayera',                   month:'Cheshvan',
    b1_theme:   'Recognize and Reveal the Divine Presence',
    b1_animal:  'Swallow (Dror)', b1_avot: 'Avot 1:14–15 — Hillel\'s sayings',
    b2_quality: 'Fear (Yirah)',                                     b2_prophet: 'Pinchas',
    b3_ruth:    'Boaz — strength (Vayera: Avraham\'s strength for hospitality)',
    b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 7 — Keep my commandments and live; guard my Torah as the apple of your eye',
    b5_shir:    'Shir 2:1–3 — I am a rose of Sharon, a lily of the valleys',
    b6_psalms:  'Ps 19–21 — The heavens declare the glory of G-d',
    b7_mesilas: 'Ch 6 — Alacrity (Zerizut): enthusiasm and speed in divine service' },
  // W8
  { week:8, parasha:'Chayei Sarah',             month:'Cheshvan',
    b1_theme:   'Not Lose Focus on Our Spirituality',
    b1_animal:  'Swift (Sis)', b1_avot: 'Avot 1:16–18 — Shammai & Rabban Shimon ben Gamliel',
    b2_quality: 'Humility (Anavah)',                               b2_prophet: 'Elkanah & Chanah',
    b3_ruth:    'Obed — he who serves (Chayei Sarah: service and dedication)',
    b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 8 — Does not Wisdom call out, does not Understanding raise her voice?',
    b5_shir:    'Shir 2:4–7 — He brought me to the banquet hall and his banner over me is love',
    b6_psalms:  'Ps 22–24 — The Lord is my shepherd, I shall not want',
    b7_mesilas: 'Ch 7 — Divisions of Alacrity: beginning and completing a mitzvah',
    b7_theme:   'The Swift is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2025/11/week-8-book-7-swift-is-saying' },
  // W9
  { week:9, parasha:'Toldot',                   month:'Kislev',
    b1_theme:   'Fighting Darkness with Light',
    b1_animal:  'Stork (Chasidah)', b1_avot: 'Avot 2:1 — Rabbi Yehudah HaNasi',
    b2_quality: 'Joy (Simchah)',                                    b2_prophet: 'Eli',
    b3_ruth:    'Yishai — G-d exists (Toldot: Yitzchak, man of wells)',
    b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 9 — Wisdom has built her house; she has hewn her seven pillars',
    b5_shir:    'Shir 2:8–10 — The voice of my beloved! Behold he comes',
    b6_psalms:  'Ps 25–27 — The Lord is my light and my salvation',
    b7_mesilas: 'Ch 8 — Acquiring Alacrity through contemplating G-d\'s greatness' },
  // W10
  { week:10, parasha:'Vayetze',                 month:'Kislev',
    b1_theme:   'Trust in G-d\'s Mercy',
    b1_animal:  'Bat', b1_avot: 'Avot 2:2–3 — Rabban Gamliel: be cautious with rulers',
    b2_quality: 'Purity (Taharah)',                                 b2_prophet: 'Shmuel',
    b3_ruth:    'Obed — servant of G-d (Vayetze: Yaakov\'s service for Rachel)',
    b3_haftara: 'Hannah\'s Prayer',
    b4_proverbs:'Prov 10 — The proverbs of Solomon: a wise son gladdens his father',
    b5_shir:    'Shir 2:11–13 — For behold, the winter has passed, the rain is over and gone',
    b6_psalms:  'Ps 28–30 — I will exalt You, O Lord, for You have raised me up',
    b7_mesilas: 'Ch 9 — Obstacles to Alacrity: laziness and excessive comfort' },
  // W11
  { week:11, parasha:'Vayishlach',              month:'Kislev',
    b1_theme:   'Fighting Evil & Heresy, Knowing How to Forgive',
    b1_animal:  'Raven', b1_avot: 'Avot 2:4–5 — Hillel: do not separate from the community',
    b2_quality: 'Ministering to sages',                            b2_prophet: 'Gad',
    b3_ruth:    'Jesse — foundation (Vayishlach: Yaakov wrestles, emerges as Yisrael)',
    b3_haftara: 'Eli and Shmuel',
    b4_proverbs:'Prov 11 — A false balance is an abomination to G-d',
    b5_shir:    'Shir 2:14–16 — My dove in the clefts of the rock, let me see your countenance',
    b6_psalms:  'Ps 31–33 — Rejoice in the Lord, O righteous',
    b7_mesilas: 'Ch 10 — Cleanliness (Nekiyut): purity of motives and subtle sins' },
  // W12
  { week:12, parasha:'Vayeshev',                month:'Kislev',
    b1_theme:   'Revealing Warmth to Those That Are Cold',
    b1_animal:  'Starling', b1_avot: 'Avot 2:6–7 — Hillel on Torah study',
    b2_quality: 'Bonding with friends (Dibuk Chaverim)',           b2_prophet: 'Natan',
    b3_ruth:    'David — beloved (Vayeshev: Yosef, beloved son)',
    b3_haftara: 'Eli and Shmuel',
    b4_proverbs:'Prov 12 — A righteous man cares for the life of his animal',
    b5_shir:    'Shir 2:17–3:2 — Until the day breathes and the shadows flee',
    b6_psalms:  'Ps 34–36 — Taste and see that the Lord is good',
    b7_mesilas: 'Ch 11 — Particulars of Cleanliness: speech, business, and personal integrity' },
  // W13
  { week:13, parasha:'Chanukah / Miketz',        month:'Kislev',
    b1_theme:   'Publicize Miracles with Pride and Humility',
    b1_animal:  'Grasshopper', b1_avot: 'Avot 2:8 — Five students of Rabban Yochanan',
    b2_quality: 'Sharp discussion with students (Pilpul HaTalmidim)', b2_prophet: 'David & Avigail',
    b3_ruth:    'Shelah — the name of Mashiach (Chanukah: hidden light revealed)',
    b3_haftara: 'Eli and Shmuel',
    b4_proverbs:'Prov 13 — A wise son heeds his father\'s instruction',
    b5_shir:    'Shir 3:3–5 — The watchmen found me as I went about the city',
    b6_psalms:  'Ps 37–39 — Commit your way to the Lord; trust in Him',
    b7_mesilas: 'Ch 12 — Acquiring Cleanliness: persistence and careful observance' },
  // W14
  { week:14, parasha:'Miketz / Vayigash',        month:'Tevet',
    b1_theme:   'Believe in Our Own Strength from G-d',
    b1_animal:  'Snail', b1_avot: 'Avot 2:9–10 — Rabbi Eliezer & Rabbi Yehoshua',
    b2_quality: 'With calmness (Yishuv)',                          b2_prophet: 'Shlomo',
    b3_ruth:    'Perez lineage — breakthrough after constriction (Yosef in dungeon)',
    b3_haftara: 'Eli and Shmuel',
    b4_proverbs:'Prov 14 — The wise woman builds her house; the foolish one tears it down',
    b5_shir:    'Shir 3:6–11 — Who is this who comes up from the wilderness like pillars of smoke?',
    b6_psalms:  'Ps 40–42 — As the deer yearns for the water brooks',
    b7_mesilas: 'Ch 13 — Separation (Perishut): distancing from excess pleasure' },
  // W15
  { week:15, parasha:'Vayigash / Vayechi',       month:'Tevet',
    b1_theme:   'Give Proper Value to Torah & the Shechinah',
    b1_animal:  'Ant', b1_avot: 'Avot 2:11–12 — Rabbi Yossi & Rabbi Shimon',
    b2_quality: 'With knowledge of Mikra (Scripture)',             b2_prophet: 'Iddo',
    b3_ruth:    'Hezron — the enclosed heart (10th Tevet: siege of Jerusalem)',
    b3_haftara: 'Eli and Shmuel',
    b4_proverbs:'Prov 15 — A gentle answer turns away wrath',
    b5_shir:    'Shir 4:1–5 — Behold you are beautiful, my beloved; your eyes are doves',
    b6_psalms:  'Ps 43–45 — My heart overflows with a goodly theme',
    b7_mesilas: 'Ch 14 — Particulars of Separation: food, relations, speech, thoughts' },
  // W16
  { week:16, parasha:'Vayechi',                  month:'Tevet',
    b1_theme:   'Use Adversity as a Way to Grow',
    b1_animal:  'Bee', b1_avot: 'Avot 2:13–14 — Rabbi Elazar on the good path',
    b2_quality: 'Knowledge of Mishnah',                            b2_prophet: 'Michah ben Imlah',
    b3_ruth:    'Ram — elevation even in exile (Yaakov blesses sons from Egypt)',
    b3_haftara: 'Eli and Shmuel',
    b4_proverbs:'Prov 16 — Pride comes before destruction',
    b5_shir:    'Shir 4:6–9 — I will go to the mountain of myrrh and to the hill of frankincense',
    b6_psalms:  'Ps 46–48 — G-d is our refuge and strength',
    b7_mesilas: 'Ch 15 — Acquiring Separation: moderation and ongoing self-examination' },
  // W17
  { week:17, parasha:'Shemot',                   month:'Tevet',
    b1_theme:   'Pay Attention to G-d\'s Guidance',
    b1_animal:  'Spider', b1_avot: 'Avot 2:15–16 — Rabbi Eliezer on repentance',
    b2_quality: 'Minimized business activity (Miut Schorah)',      b2_prophet: 'Ovadiah',
    b3_ruth:    'Aminadav — willing-hearted (Moshe: willing to lead despite reluctance)',
    b3_haftara: 'Eli and Shmuel',
    b4_proverbs:'Prov 17 — Better is a dry morsel with quiet than a house full of feasting with strife',
    b5_shir:    'Shir 4:10–15 — Your lips, O my bride, drip honey',
    b6_psalms:  'Ps 49–51 — Have mercy on me, O G-d, according to Your loving-kindness',
    b7_mesilas: 'Ch 16 — Purity (Taharah): purifying one\'s heart and imagination' },
  // W18
  { week:18, parasha:'Vaera',                    month:'Shvat',
    b1_theme:   'Live in Harmony with Nature, Above Nature',
    b1_animal:  'Scorpion', b1_avot: 'Avot 3:1 — Akavyah ben Mahalalel: know your origin',
    b2_quality: 'Minimized worldly activity (Miut Derech Eretz)',  b2_prophet: 'Ahiah HaShiloni',
    b3_ruth:    'Nachshon — daring first step (Moshe confronts Pharaoh again and again)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 18 — A brother offended is harder to win than a strong city',
    b5_shir:    'Shir 4:16–5:2 — Awake, O north wind, come O south wind',
    b6_psalms:  'Ps 52–54 — O G-d, save me by Your name',
    b7_mesilas: 'Ch 17 — Particulars of Purity: refining thought and imagination',
    b7_theme:   'The Scorpion is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2017/08/the-scorpion-is-saying.html' },
  // W19
  { week:19, parasha:'Bo',                       month:'Shvat',
    b1_theme:   'Feel that G-d is Close Even When Far Away',
    b1_animal:  'Snake', b1_avot: 'Avot 3:2–3 — Rabbi Chanina & Rabbi Shimon',
    b2_quality: 'Minimized pleasure (Miut Ta\'anug)',              b2_prophet: 'Yehu ben Chanani',
    b3_ruth:    'Salmon — garment/protection (Bo: Pesach preparations, chametz removal)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 19 — Wealth adds many friends; the poor man is separated from his friend',
    b5_shir:    'Shir 5:3–7 — I have taken off my robe, shall I put it on again?',
    b6_psalms:  'Ps 55–57 — Be gracious to me, O G-d, be gracious to me',
    b7_mesilas: 'Ch 18 — Acquiring Purity: constant mindfulness and directed thought',
    b7_theme:   'The Snake is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2013/03/week-47-book-7-snake-is-saying.html' },
  // W20
  { week:20, parasha:'Beshalach',                month:'Shvat',
    b1_theme:   'Be Solid and Giving in Our Relationships',
    b1_animal:  'Frog', b1_avot: 'Avot 3:4–5 — Rabbi Chananya ben Teradyon',
    b2_quality: 'Minimized sleep (Miut Sheinah)',                  b2_prophet: 'Azariah ben Oded',
    b3_ruth:    'Boaz — strength in the sea (Beshalach: crossing the sea, song of the sea)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 20 — Wine is a mocker, strong drink a brawler',
    b5_shir:    'Shir 5:8–6:1 — I charge you, O daughters of Jerusalem, if you find my beloved',
    b6_psalms:  'Ps 58–60 — O G-d, You have rejected us and broken our defenses',
    b7_mesilas: 'Ch 19 — Piety (Chassidut): going beyond the letter of the law' },
  // W21
  { week:21, parasha:'Yitro',                    month:'Shvat',
    b1_theme:   'Keep Things in Perspective',
    b1_animal:  'Fly', b1_avot: 'Avot 3:6–7 — Rabbi Chalafta & Rabbi Elazar',
    b2_quality: 'Minimized conversation (Miut Sichah)',            b2_prophet: 'Yachaziel HaLevi',
    b3_ruth:    'Obed — service (Yitro: Moshe receives Torah, judges the people)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 21 — A king\'s heart is like rivulets of water in G-d\'s hand',
    b5_shir:    'Shir 6:2–5 — My beloved has gone down to his garden, to the beds of spices',
    b6_psalms:  'Ps 61–63 — My soul thirsts for You in a dry and weary land',
    b7_mesilas: 'Ch 20 — Particulars of Piety: prayer, love of G-d, and humility',
    b7_theme:   'The Fly is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2014/01/week-21-to-keep-things-in-perspective.html' },
  // W22
  { week:22, parasha:'Mishpatim',                month:'Adar',
    b1_theme:   'Complement Each Other in Happiness',
    b1_animal:  'Worm', b1_avot: 'Avot 3:8–9 — Rabbi Nehunyah & Rabbi Chananya ben Akashyah',
    b2_quality: 'Minimized laughter (Miut Schok)',                 b2_prophet: 'Eliezer ben Dodavahu',
    b3_ruth:    'Yishai — foundation (Mishpatim: laws that sustain civilization)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 22 — Train the child in the way he should go',
    b5_shir:    'Shir 6:6–9 — As beautiful as the moon, as pure as the sun',
    b6_psalms:  'Ps 64–66 — Shout joyfully to G-d, all the earth',
    b7_mesilas: 'Ch 21 — Acquiring Piety: love of G-d through meditation on His greatness' },
  // W23
  { week:23, parasha:'Purim',                    month:'Adar',
    b1_theme:   'Be Happy Even Without Knowing Why',
    b1_animal:  'Mouse', b1_avot: 'Avot 3:10–11 — Rabbi Dosa & Rabbi Elazar HaModa\'i',
    b2_quality: 'With slowness to anger (Erech Apayim)',           b2_prophet: 'Hoshea',
    b3_ruth:    'David — the hidden king revealed (Purim: Esther\'s hidden identity revealed)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 23 — Do not eat the bread of a stingy man; do not desire his delicacies',
    b5_shir:    'Shir 6:10–12 — Who is this who shines through like the dawn?',
    b6_psalms:  'Ps 67–69 — Save me, O G-d, for the waters have reached my soul',
    b7_mesilas: 'Ch 22 — Humility (Anavah): seeing oneself clearly before G-d',
    b7_theme:   'The Mouse is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2017/07/the-mouse-is-saying.html' },
  // W24
  { week:24, parasha:'Terumah',                  month:'Adar',
    b1_theme:   'Live Above Our Worldly Concerns',
    b1_animal:  'Cat', b1_avot: 'Avot 3:12–13 — Rabbi Yishmael & Rabbi Akiva',
    b2_quality: 'Good heart (Lev Tov)',                            b2_prophet: 'Yoel',
    b3_ruth:    'Perez — contributing to the building (Terumah: building the Mishkan)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 24 — Do not envy evil men or desire to be with them',
    b5_shir:    'Shir 7:1–5 — How beautiful are your feet in sandals, O nobleman\'s daughter',
    b6_psalms:  'Ps 70–72 — Give the king Your judgments, O G-d',
    b7_mesilas: 'Ch 23 — Particulars of Humility: honor, position, and recognition',
    b7_theme:   'The Cat is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2017/07/the-cat-is-saying.html' },
  // W25
  { week:25, parasha:'Tetzaveh',                 month:'Adar',
    b1_theme:   'Have Self-Sacrifice to Fulfill Our Mission',
    b1_animal:  'Ox', b1_avot: 'Avot 3:14–15 — Rabbi Akiva on love of man',
    b2_quality: 'Trusting in the Sages (Emunat Chachamim)',        b2_prophet: 'Amos',
    b3_ruth:    'Hezron — enclosure and sacred garments (Tetzaveh: priestly garments)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 25 — A word aptly spoken is like apples of gold in settings of silver',
    b5_shir:    'Shir 7:6–10 — How beautiful and pleasant you are, O love, with all your charms',
    b6_psalms:  'Ps 73–75 — Truly G-d is good to Israel, to those pure of heart',
    b7_mesilas: 'Ch 24 — Acquiring Humility: knowing one\'s place and G-d\'s greatness' },
  // W26
  { week:26, parasha:'Ki Tisa',                  month:'Nissan',
    b1_theme:   'Be Humble and Let G-d Guide Us',
    b1_animal:  'Wild Ox (Re\'em)', b1_avot: 'Avot 3:16–17 — Rabbi Elazar ben Azaryah',
    b2_quality: 'Accepting of suffering (Ohev et HaYisurin)',      b2_prophet: 'Michah',
    b3_ruth:    'Ram — elevated service despite failures (Ki Tisa: Golden Calf, Moshe intercedes)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 26 — Like snow in summer and rain at harvest, so honor is unseemly for a fool',
    b5_shir:    'Shir 7:11–8:2 — Come, my beloved, let us go forth to the field',
    b6_psalms:  'Ps 76–78 — A psalm of Asaph: G-d is known in Judah',
    b7_mesilas: 'Ch 25 — Fear of Sin (Yirat Chet): constant mindfulness of G-d\'s presence' },
  // W27
  { week:27, parasha:'Pesach',                   month:'Nissan',
    b1_theme:   'Purify Ourselves in Order to Change',
    b1_animal:  'Horse', b1_avot: 'Avot 3:18 — Rabbi Akiva: beloved is Israel',
    b2_quality: 'Knowing one\'s place (Makir et Mekomo)',          b2_prophet: 'Nachum',
    b3_ruth:    'Aminadav — willing-hearted (Pesach: nation springs to freedom)',
    b3_haftara: 'The Tribes in War',
    b4_proverbs:'Prov 27 — Do not boast about tomorrow; you do not know what a day may bring',
    b5_shir:    'Shir 8:3–7 — His left hand under my head, his right hand embracing me',
    b6_psalms:  'Ps 79–81 — Blow the shofar at the new moon, at the full moon on our feast day',
    b7_mesilas: 'Ch 26 — Particulars of Fear of Sin: examination of deeds and thoughts',
    b7_theme:   'The Ox is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/05/the-ox-is-saying-songs-for-week-34.html' },
  // W28
  { week:28, parasha:'Shemini',                  month:'Nissan',
    b1_theme:   'Recognize Our Limits to Free Ourselves',
    b1_animal:  'Mule', b1_avot: 'Avot 4:1 — Ben Zoma on strength and honor',
    b2_quality: 'Happy with one\'s portion (Sameach beChelko)',    b2_prophet: 'Chavakuk',
    b3_ruth:    'Nachshon — boldness (Shemini: inauguration of Mishkan, Nadav and Avihu)',
    b3_haftara: 'Deborah',
    b4_proverbs:'Prov 28 — The wicked flee when no man pursues',
    b5_shir:    'Shir 8:8–14 — We have a little sister and she has no breasts',
    b6_psalms:  'Ps 82–84 — How lovely are Your tabernacles, O Lord of Hosts',
    b7_mesilas: 'Ch 27 — Holiness (Kedushah): sanctifying all physical activities for G-d',
    b7_theme:   'The Horse is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/05/the-horse-is-saying-songs-for-week-31.html' },
  // W29
  { week:29, parasha:'Tazria',                   month:'Nissan',
    b1_theme:   'After the Initial Inspiration, Get to Work',
    b1_animal:  'Camel', b1_avot: 'Avot 4:2 — Ben Azzai: mitzvah leads to mitzvah',
    b2_quality: 'Making a fence for one\'s words (Oseh Seyag Lidvarav)', b2_prophet: 'Tzefanyah',
    b3_ruth:    'Salmon — garment/protection (Tazria: laws of purity after birth)',
    b3_haftara: 'Deborah',
    b4_proverbs:'Prov 29 — Where there is no vision, the people perish',
    b5_shir:    'Shir 1:1 (Cycle 2) — The Song of Songs which is Solomon\'s',
    b6_psalms:  'Ps 85–87 — You have been favorable to Your land, O Lord',
    b7_mesilas: 'Ch 28 — Acquiring Holiness: consecrating all deeds and intentions',
    b7_theme:   'The Mule is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/05/the-mule-is-saying.html' },
  // W30
  { week:30, parasha:'Metzora',                  month:'Iyar',
    b1_theme:   'Know the World Needs More Love and Respect',
    b1_animal:  'Sheep / Lamb', b1_avot: 'Avot 4:3–4 — Rabbi Levitas & Rabbi Yochanan ben Beroka',
    b2_quality: 'Not claiming credit (Eino Machazik Tova leAtzmo)', b2_prophet: 'Chaggai',
    b3_ruth:    'Boaz — kindness and strength (Metzora: purification and return to community)',
    b3_haftara: 'Deborah',
    b4_proverbs:'Prov 30 — Who can find a virtuous woman? Her price is far above rubies',
    b5_shir:    'Shir 1:2–4 (Cycle 2) — Your oils have a goodly fragrance',
    b6_psalms:  'Ps 88–90 — Lord, You have been our dwelling place throughout all generations',
    b7_mesilas: 'Ch 29 — Particulars of Holiness: elevating food, sleep, and physical acts',
    b7_theme:   'The Camel is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/04/the-camel-is-saying-songs-for-week-30.html' },
  // W31
  { week:31, parasha:'Acharei Mot',              month:'Iyar',
    b1_theme:   'Be Proud of Our Humble Connection with G-d',
    b1_animal:  'Goat', b1_avot: 'Avot 4:5–6 — Rabbi Yishmael ben Rabbi Yossi',
    b2_quality: 'Beloved (Ahuv)',                                  b2_prophet: 'Zecharyah',
    b3_ruth:    'Obed — service on Yom Kippur (Acharei Mot: Yom Kippur service)',
    b3_haftara: 'Deborah',
    b4_proverbs:'Prov 31 — Eshet Chayil: a woman of valor, who can find?',
    b5_shir:    'Shir 1:5–7 (Cycle 2) — I am dark but comely',
    b6_psalms:  'Ps 91–93 — The Lord reigns; He is clothed in majesty',
    b7_mesilas: 'Ch 30 — Ruach HaKodesh (Divine Inspiration): the crown of the ladder',
    b7_theme:   'The Lamb is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/04/the-lamb-is-saying-songs-for-week-26.html' },
  // W32
  { week:32, parasha:'Kedoshim',                 month:'Iyar',
    b1_theme:   'Recognize Deep in Our Heart How Small We Are',
    b1_animal:  'Ram', b1_avot: 'Avot 4:7–8 — Rabbi Tzadok & Rabbi Yossi on Torah',
    b2_quality: 'Loved by G-d (Ahov et HaMakom)',                  b2_prophet: 'Malachi',
    b3_ruth:    'Yishai — foundation of holiness (Kedoshim: be holy as I am holy)',
    b3_haftara: 'Deborah',
    b4_proverbs:'Prov 1 (Cycle 2) — The beginning of wisdom is awe of G-d',
    b5_shir:    'Shir 1:8–11 (Cycle 2) — If you do not know yourself',
    b6_psalms:  'Ps 94–96 — O come, let us sing to the Lord',
    b7_mesilas: 'Introduction (Cycle 2) — Man\'s purpose revisited in light of practice' },
  // W33
  { week:33, parasha:'Emor',                     month:'Iyar',
    b1_theme:   'Recognize the Spiritual Treasures Within Each',
    b1_animal:  'Donkey', b1_avot: 'Avot 4:9–10 — Rabbi Yonatan & Rabbi Meir',
    b2_quality: 'Loved by people (Ahov et HaBriyot)',             b2_prophet: 'Shimeon ben Tiferet',
    b3_ruth:    'David — kingly bearing (Emor: holiness of the Kohen and the holidays)',
    b3_haftara: 'Deborah',
    b4_proverbs:'Prov 2 (Cycle 2) — If you seek it like silver',
    b5_shir:    'Shir 1:12–14 (Cycle 2) — While the king was at his table',
    b6_psalms:  'Ps 97–99 — The Lord reigns; let the earth rejoice',
    b7_mesilas: 'Ch 1 (Cycle 2) — Man\'s Duty: renewed clarity of purpose' },
  // W34
  { week:34, parasha:'Behar',                    month:'Iyar',
    b1_theme:   'Work in a Focused Manner and Without Ego',
    b1_animal:  'Lion', b1_avot: 'Avot 4:11–12 — Rabbi Eliezer ben Yaakov',
    b2_quality: 'Loves correction (Ohev et HaTochachot)',          b2_prophet: 'Ezra',
    b3_ruth:    'Perez — release and redemption (Behar: Shmitah, release of debts)',
    b3_haftara: 'Devorah and the women of Israel',
    b4_proverbs:'Prov 3 (Cycle 2) — Trust in G-d with all your heart',
    b5_shir:    'Shir 1:15–17 (Cycle 2) — Behold you are beautiful',
    b6_psalms:  'Ps 100–102 — O Lord, hear my prayer; let my cry come to You',
    b7_mesilas: 'Ch 2 (Cycle 2) — Watchfulness deepened through experience',
    b7_theme:   'The Donkey is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/05/the-donkey-is-saying-songs-for-week-33.html' },
  // W35
  { week:35, parasha:'Bechukotai',               month:'Sivan',
    b1_theme:   'Thank G-d in Unison',
    b1_animal:  'Bear', b1_avot: 'Avot 4:13–14 — Rabbi Yochanan HaSandlar',
    b2_quality: 'Distances from honor (Ohev et HaMeisharim)',      b2_prophet: 'Nechemiah',
    b3_ruth:    'Hezron — enclosed strength (Bechukotai: blessings for keeping Torah)',
    b3_haftara: 'Devorah and the women of Israel',
    b4_proverbs:'Prov 4 (Cycle 2) — Acquire wisdom, acquire understanding',
    b5_shir:    'Shir 2:1–3 (Cycle 2) — I am a rose of Sharon',
    b6_psalms:  'Ps 103–105 — Bless the Lord, O my soul',
    b7_mesilas: 'Ch 3 (Cycle 2) — Watchfulness divisions: examining one\'s inner world' },
  // W36
  { week:36, parasha:'Shavuot',                  month:'Sivan',
    b1_theme:   'Have Emunah',
    b1_animal:  'Wolf', b1_avot: 'Avot 4:15–16 — Rabbi Yehudah on Torah study',
    b2_quality: 'Torah enclothes him with humility',               b2_prophet: 'Mordechai',
    b3_ruth:    'Ram — the whole Book of Ruth read on Shavuot (Ruth: loyalty and Torah)',
    b3_haftara: 'Devorah and the women of Israel',
    b4_proverbs:'Prov 5 (Cycle 2) — Beware the strange woman',
    b5_shir:    'Shir 2:4–7 (Cycle 2) — He brought me to the banquet hall',
    b6_psalms:  'Ps 106–108 — Give thanks to the Lord, for He is good',
    b7_mesilas: 'Ch 4 (Cycle 2) — Acquiring Watchfulness: self-examination leads to growth',
    b7_theme:   'The Lion is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2017/06/the-lion-is-saying.html' },
  // W37
  { week:37, parasha:'Bamidbar',                 month:'Sivan',
    b1_theme:   'Maintain Our Humility After Greatness',
    b1_animal:  'Fox', b1_avot: 'Avot 4:17 — Three crowns and the crown of a good name',
    b2_quality: 'Torah enclothes him with fear',                   b2_prophet: 'Chananyah ben Hezekiah',
    b3_ruth:    'Aminadav — the willing count (Bamidbar: counting of the people)',
    b3_haftara: 'Devorah and the women of Israel',
    b4_proverbs:'Prov 6 (Cycle 2) — Go to the ant, you sluggard',
    b5_shir:    'Shir 2:8–10 (Cycle 2) — The voice of my beloved',
    b6_psalms:  'Ps 109–111 — Praise the Lord! I will give thanks with my whole heart',
    b7_mesilas: 'Ch 5 (Cycle 2) — Obstacles to Watchfulness revisited with new depth',
    b7_theme:   'The Bear is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2017/06/week-39-bear-is-saying.html' },
  // W38
  { week:38, parasha:'Naso',                     month:'Sivan',
    b1_theme:   'Be Strong and Courageous for the Common Good',
    b1_animal:  'Wild Deer (Tzvi)', b1_avot: 'Avot 4:18–19 — Rabbi Shimon ben Elazar',
    b2_quality: 'Torah makes him fit to be righteous',             b2_prophet: 'Natan',
    b3_ruth:    'Nachshon — the Nasi (prince) who offers first (Naso: Nassi offerings)',
    b3_haftara: 'Devorah and the women of Israel',
    b4_proverbs:'Prov 7 (Cycle 2) — Keep my commandments and live',
    b5_shir:    'Shir 2:11–13 (Cycle 2) — For behold, the winter has passed',
    b6_psalms:  'Ps 112–114 — When Israel went out from Egypt',
    b7_mesilas: 'Ch 6 (Cycle 2) — Alacrity deepened: acting from love, not obligation',
    b7_theme:   'The Wolf is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/07/the-wolf-is-saying.html' },
  // W39
  { week:39, parasha:'Behaalotecha',             month:'Tammuz',
    b1_theme:   'See the World in a Positive Light to Elevate It',
    b1_animal:  'Gazelle', b1_avot: 'Avot 4:20–21 — Rabbi Elisha ben Avuya',
    b2_quality: 'Torah makes him fit to be correct (Yashar)',      b2_prophet: 'Gad',
    b3_ruth:    'Salmon — lighting the menorah (Behaalotecha: Aaron lights the menorah)',
    b3_haftara: 'Yiftach\'s daughter',
    b4_proverbs:'Prov 8 (Cycle 2) — Does not Wisdom call out?',
    b5_shir:    'Shir 2:14–16 (Cycle 2) — My dove in the clefts of the rock',
    b6_psalms:  'Ps 115–118 — This is the day the Lord has made; let us rejoice',
    b7_mesilas: 'Ch 7 (Cycle 2) — Alacrity divisions: beginning and finishing with the same fire',
    b7_theme:   'The Fox is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2017/07/the-fox-is-saying.html' },
  // W40
  { week:40, parasha:'Shelach',                  month:'Tammuz',
    b1_theme:   'Fight for Truth',
    b1_animal:  'Ibex (Ya\'el)', b1_avot: 'Avot 4:22 — Rabbi Yaakov on Olam Haba',
    b2_quality: 'Torah makes him beloved (Ahov)',                  b2_prophet: 'Natan',
    b3_ruth:    'Boaz — faithful amid spies (Shelach: spies sent to Canaan)',
    b3_haftara: 'Yiftach\'s daughter',
    b4_proverbs:'Prov 9 (Cycle 2) — Wisdom has built her house',
    b5_shir:    'Shir 2:17–3:2 (Cycle 2) — Until the day breathes',
    b6_psalms:  'Ps 119:1–96 — Happy are those whose way is blameless',
    b7_mesilas: 'Ch 8 (Cycle 2) — Acquiring Alacrity through love of G-d\'s commandments' },
  // W41
  { week:41, parasha:'Korach',                   month:'Tammuz',
    b1_theme:   'Not Become Corrupt',
    b1_animal:  'Hare (Arnevet)', b1_avot: 'Avot 4:23–24 — Rabbi Shimon ben Elazar on the right time',
    b2_quality: 'Torah loves him (Ohavo)',                         b2_prophet: 'Eliyahu',
    b3_ruth:    'Obed — the servant vs. the rebel (Korach\'s rebellion against Moshe)',
    b3_haftara: 'Yiftach\'s daughter',
    b4_proverbs:'Prov 10 (Cycle 2) — A wise son gladdens his father',
    b5_shir:    'Shir 3:3–5 (Cycle 2) — The watchmen found me',
    b6_psalms:  'Ps 119:97–176 — Oh, how I love Your Torah!',
    b7_mesilas: 'Ch 9 (Cycle 2) — Obstacles to Alacrity: identifying inner inertia',
    b7_theme:   'The Gazelle is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2017/06/the-gazelle-is-saying.html' },
  // W42
  { week:42, parasha:'Chukat',                   month:'Tammuz',
    b1_theme:   'Be Loyal and Pursue Justice',
    b1_animal:  'Hedgehog (Kipod)', b1_avot: 'Avot 5:1–3 — World created with 10 utterances',
    b2_quality: 'Torah gives him a kingdom',                       b2_prophet: 'Eliyahu',
    b3_ruth:    'Yishai — the statute beyond understanding (Chukat: the red heifer)',
    b3_haftara: 'Yiftach\'s daughter',
    b4_proverbs:'Prov 11 (Cycle 2) — A false balance is an abomination',
    b5_shir:    'Shir 3:6–11 (Cycle 2) — Who is this who comes up from the wilderness?',
    b6_psalms:  'Ps 120–122 — I lift my eyes to the mountains',
    b7_mesilas: 'Ch 10 (Cycle 2) — Cleanliness: rooting out subtle rationalized sins' },
  // W43
  { week:43, parasha:'Balak',                    month:'Av',
    b1_theme:   'Pursue the Enemy and Pursue Peace',
    b1_animal:  'Pig (Chazir)', b1_avot: 'Avot 5:4–6 — Ten miracles in the Wilderness',
    b2_quality: 'Torah gives him dominion',                        b2_prophet: 'Elisha',
    b3_ruth:    'David — peace against Balak\'s curses (Balak: Bilaam\'s curses turned to blessing)',
    b3_haftara: 'Yiftach\'s daughter',
    b4_proverbs:'Prov 12 (Cycle 2) — A righteous man cares for his animal',
    b5_shir:    'Shir 4:1–5 (Cycle 2) — Behold you are beautiful, my beloved',
    b6_psalms:  'Ps 123–125 — Those who trust in G-d are like Mount Zion',
    b7_mesilas: 'Ch 11 (Cycle 2) — Particulars of Cleanliness: refining speech and thought',
    b7_theme:   'The Pig is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/04/the-pig-is-saying-songs-for-week-28.html' },
  // W44
  { week:44, parasha:'Pinchas',                  month:'Av',
    b1_theme:   'Recognize Our Mistakes and Change',
    b1_animal:  'Leviathan', b1_avot: 'Avot 5:7 — Seven things of a golem vs. a sage',
    b2_quality: 'Torah reveals to him secrets of the Torah',       b2_prophet: 'Elisha',
    b3_ruth:    'Perez — zealous action for righteousness (Pinchas: Pinchas\'s zealotry)',
    b3_haftara: 'Eliyahu',
    b4_proverbs:'Prov 13 (Cycle 2) — A wise son heeds his father\'s instruction',
    b5_shir:    'Shir 4:6–9 (Cycle 2) — I will go to the mountain of myrrh',
    b6_psalms:  'Ps 126–128 — Unless G-d builds the house, the builders labor in vain',
    b7_mesilas: 'Ch 12 (Cycle 2) — Acquiring Cleanliness through consistent vigilance',
    b7_theme:   'The Leviathan is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/03/the-leviathan-is-saying.html' },
  // W45
  { week:45, parasha:'Matot-Masei',              month:'Av',
    b1_theme:   'Raise Ourselves Up Through Love and Humility',
    b1_animal:  'Fish', b1_avot: 'Avot 5:8–9 — Seven kinds of punishment',
    b2_quality: 'Torah makes him like a never-failing spring',     b2_prophet: 'Elisha',
    b3_ruth:    'Hezron — the journey home (Matot-Masei: journeys in the desert)',
    b3_haftara: 'Eliyahu',
    b4_proverbs:'Prov 14 (Cycle 2) — The wise woman builds her house',
    b5_shir:    'Shir 4:10–15 (Cycle 2) — Your lips, O my bride, drip honey',
    b6_psalms:  'Ps 129–131 — Out of the depths I cry to You, O Lord',
    b7_mesilas: 'Ch 13 (Cycle 2) — Separation: voluntary withdrawal for spiritual depth',
    b7_theme:   'The Fish are Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/03/the-fish-are-saying.html' },
  // W46
  { week:46, parasha:'Devarim',                  month:'Av',
    b1_theme:   'Know Our Place in Order to Be Truly Happy',
    b1_animal:  'Great Whale', b1_avot: 'Avot 5:10–11 — Four types of donors',
    b2_quality: 'Torah makes him humble',                          b2_prophet: 'Yeshayahu',
    b3_ruth:    'Ram — Moshe\'s last speech (Devarim: Moshe\'s farewell words of rebuke)',
    b3_haftara: 'Eliyahu',
    b4_proverbs:'Prov 15 (Cycle 2) — A gentle answer turns away wrath',
    b5_shir:    'Shir 4:16–5:2 (Cycle 2) — Awake, O north wind',
    b6_psalms:  'Ps 132–134 — Behold how good and pleasant it is',
    b7_mesilas: 'Ch 14 (Cycle 2) — Particulars of Separation: time, food, and focus',
    b7_theme:   'Giant Sea Creatures are Saying',
    b7_url:     'https://www.kabbalahoftime.com/2021/02/week-22-book-7-giant-sea-creatures-are.html' },
  // W47
  { week:47, parasha:'Vaetchanan',               month:'Elul',
    b1_theme:   'Time for Teshuvah — Return to G-d!',
    b1_animal:  'Sea / Waves', b1_avot: 'Avot 5:12–13 — Four types of students',
    b2_quality: 'Torah makes him far from sin',                    b2_prophet: 'Yirmiyahu',
    b3_ruth:    'Aminadav — Shema Yisrael and willing return (Vaetchanan: Shema)',
    b3_haftara: 'Seven Haftarot of Consolation',
    b4_proverbs:'Prov 16 (Cycle 2) — Pride comes before destruction',
    b5_shir:    'Shir 5:3–7 (Cycle 2) — I have taken off my robe',
    b6_psalms:  'Ps 135–137 — By the rivers of Babylon, there we sat and wept',
    b7_mesilas: 'Ch 15 (Cycle 2) — Acquiring Separation through self-mastery' },
  // W48
  { week:48, parasha:'Eikev',                    month:'Elul',
    b1_theme:   'Fight Coldness with Warmth',
    b1_animal:  'Rivers (Naharot)', b1_avot: 'Avot 5:14–15 — Four types of Torah students',
    b2_quality: 'Torah gives him a good name',                     b2_prophet: 'Yechezkel',
    b3_ruth:    'Nachshon — walking in G-d\'s ways (Eikev: if you walk in My commandments)',
    b3_haftara: 'Seven Haftarot of Consolation',
    b4_proverbs:'Prov 17 (Cycle 2) — Better a dry morsel with quiet',
    b5_shir:    'Shir 5:8–6:1 (Cycle 2) — I charge you, O daughters of Jerusalem',
    b6_psalms:  'Ps 138–140 — O Lord, You have probed me and You know me',
    b7_mesilas: 'Ch 16 (Cycle 2) — Purity: deeper refinement of inner life' },
  // W49
  { week:49, parasha:"Re\'eh",                    month:'Elul',
    b1_theme:   'Bring More Light to Extinguish Darkness',
    b1_animal:  'Frogs (aquatic)', b1_avot: 'Avot 5:16–17 — Four types of disputes',
    b2_quality: 'Torah raises up his heart',                       b2_prophet: 'Daniel',
    b3_ruth:    'Salmon — clear choices: blessing and curse (Re\'eh: see I give before you)',
    b3_haftara: 'Seven Haftarot of Consolation',
    b4_proverbs:'Prov 18 (Cycle 2) — A brother offended is harder to win',
    b5_shir:    'Shir 6:2–5 (Cycle 2) — My beloved has gone down to his garden',
    b6_psalms:  'Ps 141–143 — O Lord, I call to You; hasten to me',
    b7_mesilas: 'Ch 17 (Cycle 2) — Purity particulars: guarding the mind for G-d\'s sake' },
  // W50
  { week:50, parasha:'Shoftim',                  month:'Elul',
    b1_theme:   'Know There Are No Limits to Our Growth',
    b1_animal:  'Swamp (Agam)', b1_avot: 'Avot 5:18–19 — Four who sat before the wise',
    b2_quality: 'Torah humbles him before greatness',              b2_prophet: 'Mordechai & Esther',
    b3_ruth:    'Boaz — justice and judges (Shoftim: appoint judges)',
    b3_haftara: 'Seven Haftarot of Consolation',
    b4_proverbs:'Prov 19 (Cycle 2) — Wealth adds many friends',
    b5_shir:    'Shir 6:6–9 (Cycle 2) — As beautiful as the moon',
    b6_psalms:  'Ps 144–146 — Praise G-d! Praise G-d from the heavens',
    b7_mesilas: 'Ch 18 (Cycle 2) — Acquiring Purity: guarding all senses for holiness',
    b7_theme:   'The Frog is Saying',
    b7_url:     'https://www.kabbalahoftime.com/2016/03/the-frog-is-saying-songs-for-week-25.html' },
  // W51
  { week:51, parasha:'Ki Teitzei',               month:'Elul',
    b1_theme:   'Understand That We Are All One Soul',
    b1_animal:  'Heavenly Creatures', b1_avot: 'Avot 5:20–21 — Ben Bag Bag & Ben Heh Heh',
    b2_quality: 'Torah builds him up',                             b2_prophet: 'Ezra & Nechemiah',
    b3_ruth:    'Obed — return of the lost (Ki Teitzei: laws of returning lost objects)',
    b3_haftara: 'Seven Haftarot of Consolation',
    b4_proverbs:'Prov 20 (Cycle 2) — Wine is a mocker, strong drink a brawler',
    b5_shir:    'Shir 6:10–12 (Cycle 2) — Who is this who shines through like the dawn?',
    b6_psalms:  'Ps 147–149 — Praise the Lord! Sing to the Lord a new song',
    b7_mesilas: 'Ch 19 (Cycle 2) — Piety: going beyond the law from love' },
  // W52
  { week:52, parasha:'Ki Tavo',                  month:'Elul',
    b1_theme:   'Crown G-d as Our King',
    b1_animal:  'Dogs', b1_avot: 'Avot 5:22–23 — Disciples of Avraham vs. Bilaam',
    b2_quality: 'Torah exalts him above all creations',            b2_prophet: 'Haggai & Zechariah',
    b3_ruth:    'David — first fruits and the harvest (Ki Tavo: bikkurim offering)',
    b3_haftara: 'Seven Haftarot of Consolation',
    b4_proverbs:'Prov 21 (Cycle 2) — A king\'s heart in G-d\'s hand; full crown of wisdom',
    b5_shir:    'Shir 7:1–5 (Cycle 2) — How beautiful are your feet in sandals',
    b6_psalms:  'Ps 150 — Praise G-d in His sanctuary; praise Him in His mighty heavens',
    b7_mesilas: 'Ch 20 (Cycle 2) — Piety particulars: prayer and love as daily service' },
  ];

  // Malchut daily texts — 7 texts cycling through the week
  // Order (by KoT day 1–7): 
  //   Day 1 (Fri eve / Shabbat): Zohar / Arizal
  //   Day 2 (Sat eve / Sunday): Keter Shem Tov  
  //   Day 3 (Sun eve / Monday): Noam Elimelech
  //   Day 4 (Mon eve / Tuesday): Tanya
  //   Day 5 (Tue eve / Wednesday): Likutei Moharan
  //   Day 6 (Wed eve / Thursday): Mesilat Yesharim
  //   Day 7 (Thu eve / Friday): Likutei Sichos / Maamarim
  // MALCHUT_TEXTS[i] where i = (dayNum - 1) % 7
  // dayNum 1=Thu→Fri, 2=Fri→Shab, 3=Sat→Sun, 4=Sun→Mon, 5=Mon→Tue, 6=Tue→Wed, 7=Wed→Thu
  const MALCHUT_TEXTS = [
    { name: 'Zohar / Arizal',      author: 'R. Shimon bar Yochai / R. Luria',    shortName: 'Zohar',    day: 'Friday — Erev Shabbat',   desc: 'Mystical depth of the Parasha — the hidden light of Torah' },
    { name: 'Likutei Sichos',      author: 'Lubavitcher Rebbe',                   shortName: 'LS',       day: 'Shabbat',                 desc: 'Weekly Maamar / Sicha on the Parasha — chassidic insight' },
    { name: 'Keter Shem Tov',      author: 'Baal Shem Tov',                      shortName: 'KST',      day: 'Sunday',                  desc: 'Foundations of Chassidic thought and Divine joy' },
    { name: 'Noam Elimelech',      author: 'R. Elimelech of Lizhensk',           shortName: 'NE',       day: 'Monday',                  desc: 'The Tzadik\'s path: elevating the world through Torah' },
    { name: 'Tanya',               author: 'Alter Rebbe (R. Schneur Zalman)',     shortName: 'Tanya',    day: 'Tuesday',                 desc: 'Likutei Amarim — the Sefer Shel Beinonim' },
    { name: 'Likutei Moharan',     author: 'Rebbe Nachman of Breslov',            shortName: 'LM',       day: 'Wednesday',               desc: 'Torah that leads to all virtues and repairs the world' },
    { name: 'Mesilat Yesharim',    author: 'Ramchal (R. Moshe Chaim Luzzatto)',   shortName: 'MY',       day: 'Thursday',                desc: 'The Path of the Upright — the ladder of holiness' },
  ];

  // ── PEREK SHIRAH — Chapter + verse for each creature ──
  const PEREK_SHIRAH_VERSES = {
    'Rooster': ['Ch 4', 'Who has given the heart wisdom? (Job 38:36)'],
    'Hen': ['Ch 4', 'He gives bread to all flesh (Ps 136:25)'],
    'Dove': ['Ch 4', 'O my dove, in the clefts of the rock (Shir 2:14)'],
    'Turtledove': ['Ch 4', 'The voice of the turtledove is heard in our land (Shir 2:12)'],
    'Eagle': ['Ch 4', 'They that wait upon the L-rd shall renew their strength (Isa 40:31)'],
    'Crane (Agur)': ['Ch 4', 'Like a crane or a swallow, so did I chatter (Isa 38:14)'],
    'Swallow (Dror)': ['Ch 4', 'The swallow and the crane observe the time of their migration (Jer 8:7)'],
    'Swift (Sis)': ['Ch 4', 'Even the sparrow has found a home (Ps 84:4)'],
    'Stork (Chasidah)': ['Ch 4', 'Praise G-d from the heavens, praise Him in the heights (Ps 148:1)'],
    'Bat': ['Ch 4', 'Comfort, comfort My people, says your G-d (Isa 40:1)'],
    'Raven': ['Ch 4', 'Who provides nourishment for the raven (Job 38:41)'],
    'Starling': ['Ch 4', 'The worker\'s sleep is sweet (Eccl 5:11)'],
    'Grasshopper': ['Ch 4', 'I am young and despised (Ps 119:141)'],
    'Snail': ['Ch 4', 'As a snail that melts away (Ps 58:9)'],
    'Ant': ['Ch 4', 'Go to the ant, you sluggard (Prov 6:6)'],
    'Bee': ['Ch 4', 'How sweet are Your words to my palate! (Ps 119:103)'],
    'Spider': ['Ch 4', 'The spider spreads her web in palaces (Prov 30:28)'],
    'Scorpion': ['Ch 4', 'The L-rd preserves the simple (Ps 116:6)'],
    'Snake': ['Ch 4', 'The L-rd supports all who fall (Ps 145:14)'],
    'Frog': ['Ch 4', 'Blessed be the name of His glorious kingdom (Ps 72:19)'],
    'Fly': ['Ch 4', 'Call out! All flesh is grass (Isa 40:6)'],
    'Worm': ['Ch 4', 'But I am a worm, not a man (Ps 22:7)'],
    'Mouse': ['Ch 4', 'Open for me the gates of righteousness (Ps 118:19)'],
    'Cat': ['Ch 4', 'I will pursue my enemies and overtake them (Ps 18:38)'],
    'Ox': ['Ch 5', 'An ox knows its owner (Isa 1:3)'],
    'Wild Ox (Re\'em)': ['Ch 5', 'G-d brings him out of Egypt (Num 23:22)'],
    'Horse': ['Ch 5', 'Have you given the horse strength? (Job 39:19)'],
    'Mule': ['Ch 5', 'I will instruct you and teach you the way (Ps 32:8)'],
    'Camel': ['Ch 5', 'Your righteousness is like the mighty mountains (Ps 36:7)'],
    'Sheep / Lamb': ['Ch 5', 'Know that the L-rd is G-d (Ps 100:3)'],
    'Goat': ['Ch 5', 'Your hair is like a flock of goats (Shir 4:1)'],
    'Ram': ['Ch 5', 'Praise His name in the dance (Ps 149:3)'],
    'Donkey': ['Ch 5', 'Yours, G-d, is the greatness and the might (Chron I 29:11)'],
    'Lion': ['Ch 5', 'The L-rd is a mighty man of war (Exod 15:3)'],
    'Bear': ['Ch 5', 'Let every soul praise the L-rd (Ps 150:6)'],
    'Wolf': ['Ch 5', 'Give strength to G-d; His majesty is over Israel (Ps 68:35)'],
    'Fox': ['Ch 5', 'Catch the foxes for us, the small foxes (Shir 2:15)'],
    'Wild Deer (Tzvi)': ['Ch 5', 'G-d, my Strength, I will play music to You (Ps 59:18)'],
    'Gazelle': ['Ch 5', 'My beloved is like a gazelle or a young deer (Shir 2:9)'],
    'Ibex (Ya\'el)': ['Ch 5', 'Do you know the time of the birth of ibexes? (Job 39:1)'],
    'Hare (Arnevet)': ['Ch 5', 'Open for me the gates of righteousness (Ps 118:19)'],
    'Hedgehog (Kipod)': ['Ch 5', 'Praise Him according to His abundant greatness (Ps 150:2)'],
    'Pig (Chazir)': ['Ch 5', 'The earth and all who dwell upon it will recognize G-d (Ps 98:9)'],
    'Leviathan': ['Ch 6', 'Praise the L-rd from the earth, great sea creatures (Ps 148:7)'],
    'Fish': ['Ch 6', 'Let the sea roar and the fullness thereof (Ps 98:7)'],
    'Great Whale': ['Ch 6', 'These are the seas, great and wide (Ps 104:25)'],
    'Sea / Waves': ['Ch 6', 'More than the voices of many waters (Ps 93:4)'],
    'Rivers (Naharot)': ['Ch 6', 'Let the rivers clap their hands (Ps 98:8)'],
    'Frogs (aquatic)': ['Ch 6', 'Praise the L-rd, all nations (Ps 117:1)'],
    'Swamp (Agam)': ['Ch 6', 'G-d is my shepherd, I shall not want (Ps 23:1)'],
    'Heavenly Creatures': ['Ch 6', 'Bless the L-rd, all His hosts (Ps 103:21)'],
    'Dogs': ['Ch 6', 'Come, let us worship and bow down (Ps 95:6)'],
  };



  function getWeeklyData(week) {
    const idx = Math.min(Math.max(week - 1, 0), 51);
    return WEEKLY_BOOKS[idx];
  }

  function getMalchutText(kotDay) {
    // kotDay 1–7, Day 1 = KoT week starts Friday eve
    // Map to 0-indexed MALCHUT_TEXTS array
    return MALCHUT_TEXTS[(kotDay - 1) % 7];
  }



  // ── RENDER ──
  function render() {
    const rawDay = getDaysDiff(currentOffset); // Days since Rosh Hashanah
    const d = rawDay; // Current Jewish day (started last night)
    const date = getDisplayDate(currentOffset);
    const dowName   = DAYS_OF_WEEK[date.getDay()];

    // Date bar
    document.getElementById('gregorian-date').textContent =
      `${dowName}, ${MONTHS[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
    document.getElementById('day-indicator').textContent =
      `Last Night: Day ${d} · Tonight Begins: Day ${d + 1}`;

    // Keter — Chabad Daily Learning
    const hDate  = gregToHebrew(date);
    const hMonth = hDate.month, hDay = hDate.day, hYear = hDate.year;
    const hMname = HEB_MONTH_NAMES[hMonth] || '';
    const hDateStr = `${hDay} ${hMname} ${hYear}`;

    // Update Hebrew date in top bar
    document.getElementById('hebrew-date').textContent = formatHebrewDate(hDay, hMonth, hYear);

    const chabadDate = `${date.getMonth()+1}/${date.getDate()}/${date.getFullYear()}`;
    const chabadBaseURL = 'https://www.chabad.org/dailystudy';
    
    // 1. Chumash with Rashi
    document.getElementById('keter-chumash-date').textContent = hDateStr;
    document.getElementById('keter-chumash-main').innerHTML = 
      `<a href="${chabadBaseURL}/torah_cdo/aid/63255/jewish/The-Torah.htm" target="_blank" style="color:var(--gold)">` +
      `View today's Chumash portion with Rashi ↗</a>`;
    document.getElementById('keter-chumash-meta').innerHTML =
      `<strong>Daily Chumash</strong> · Divided into 7 daily sections`;

    // 2. Tehillim
    const tehillimDayOfMonth = date.getDate();
    const tehillimChapter = tehillimDayOfMonth <= 29 ? 
      `Chapters ${(tehillimDayOfMonth - 1) * 5 + 1}-${tehillimDayOfMonth * 5}` :
      `Chapters 146-150`;
    document.getElementById('keter-tehillim-main').innerHTML =
      `<strong>${tehillimChapter}</strong><br>` +
      `<a href="${chabadBaseURL}/tehillim_cdo/aid/1455591/jewish/Psalms.htm" target="_blank" style="color:var(--gold);font-size:11px">` +
      `Read on Chabad.org ↗</a>`;
    document.getElementById('keter-tehillim-meta').innerHTML =
      `<strong>Psalms</strong> · Day ${tehillimDayOfMonth} of month`;

    // 3. Tanya
    document.getElementById('keter-tanya-main').innerHTML =
      `<a href="${chabadBaseURL}/tanya_cdo/aid/7876/jewish/Daily-Tanya.htm" target="_blank" style="color:var(--gold)">` +
      `View today's Tanya lesson ↗</a>`;
    document.getElementById('keter-tanya-meta').innerHTML =
      `<strong>Tanya</strong> · Likutei Amarim by the Alter Rebbe`;

    // 4. Rambam  
    document.getElementById('keter-rambam-main').innerHTML =
      `<a href="${chabadBaseURL}/rambam_cdo/aid/682956/jewish/Rambam.htm" target="_blank" style="color:var(--gold)">` +
      `View today's Rambam (3 chapters) ↗</a>`;
    document.getElementById('keter-rambam-meta').innerHTML =
      `<strong>Rambam</strong> · Mishneh Torah · 3 chapters/day`;

    // 5. Hayom Yom
    const chabadURL  = `${chabadBaseURL}/hayomyom.asp?tdate=${chabadDate}`;
    const hyText = getHayomYom(hMonth, hDay);
    if (hyText) {
      document.getElementById('keter-hayomyom').innerHTML =
        `"${hyText}" &nbsp;<a href="${chabadURL}" target="_blank" style="color:var(--gold);font-style:normal;font-size:11px">full entry ↗</a>`;
    } else {
      document.getElementById('keter-hayomyom').innerHTML =
        `<a href="${chabadURL}" target="_blank" style="color:var(--gold)">Read today's Hayom Yom on Chabad.org ↗</a>`;
    }
    document.getElementById('keter-hy-meta').innerHTML =
      `<strong>Hayom Yom</strong> · Rebbe Menachem Mendel Schneerson`;

    // 6. Likutei Moharan
    const lmLesson = d; // LM lesson matches KoT day number
    const lmData   = LM_THEMES[lmLesson];
    const seferiaURL = lmData
      ? lmData.url
      : `https://www.sefaria.org/Likutei_Moharan.${lmLesson}`;
    document.getElementById('keter-lm-main').innerHTML = lmData
      ? `Lesson <strong>${lmLesson}</strong> — ${lmData.theme}<br>
         <span style="font-size:11px;color:var(--ink-mid);font-style:italic">${lmData.summary}</span>`
      : `Lesson <strong>${lmLesson}</strong>`;
    document.getElementById('keter-lm-meta').innerHTML =
      `<strong>Likutei Moharan</strong> · Rebbe Nachman of Breslov &nbsp;·&nbsp; ` +
      `<a href="${seferiaURL}" target="_blank" style="color:var(--gold)">Read on Sefaria ↗</a>`;

    // 7. Daf Yomi
    const daf = getDafYomi(date);
    if (daf) {
      const ytQuery  = encodeURIComponent(`${daf.name} ${daf.daf}`);
      const ytSearch = `https://www.youtube.com/@mercazdafyomi/search?query=${ytQuery}`;
      document.getElementById('keter-daf-masechet').innerHTML =
        `<span style="font-size:1.1em">${daf.heb}</span>`;
      document.getElementById('keter-daf-main').innerHTML =
        `<strong>${daf.name}</strong>, Daf <strong>${daf.daf}</strong>`;
      document.getElementById('keter-daf-meta').innerHTML =
        `<strong>Daf Yomi</strong> · Cycle 14 &nbsp;·&nbsp; ` +
        `<a href="${ytSearch}" target="_blank" style="color:var(--gold)">MDY Shiur ↗</a>`;
    } else {
      document.getElementById('keter-daf-masechet').textContent = 'Daf Yomi';
      document.getElementById('keter-daf-main').textContent    = 'Cycle 14';
      document.getElementById('keter-daf-meta').textContent    = '';
    }

    const sef  = getSefirotInfo(d);
    const cy22 = get22DayInfo(d);
    const cy13 = get13DayInfo(d);
    const cy41 = get41DayInfo(d);
    const hal  = getHalachaInfo(d);
    const txt  = getDailyText(date);

    const cards = document.querySelectorAll('.sefirah-card');

    // CHOCHMAH — 22-Day Alef-Bet
    document.getElementById('chochmah-cycle-name').textContent = 'Alef-Bet — 22-Day Cycle';
    document.getElementById('chochmah-main').innerHTML =
      `Set <strong>${cy22.cycle}</strong> — <strong>${cy22.letters}</strong> <span style="font-size:1.1em">${cy22.hebrew}</span><br>` +
      `<span style="font-size:0.9em;color:var(--ink-mid)">Day ${cy22.day} · Letter: ${cy22.dailyLetter} ${cy22.dailyHebrew}</span>`;
    document.getElementById('chochmah-sub').textContent = `Theme: ${cy22.theme}`;
    document.getElementById('chochmah-tags').innerHTML =
      `<span class="tag highlight">${cy22.dailyLetter} ${cy22.dailyHebrew}</span><span class="tag">Day ${cy22.day} of 22</span><span class="tag">${cy22.letters}</span>`;
    
    // Acrostic Psalms mapping to 22-day cycles (based on blog)
    const ACROSTIC_PSALMS = {
      1: 'Psalms 9-10',
      2: 'Psalm 25',
      3: 'Psalm 34',
      4: 'Psalm 37',
      5: 'Psalm 111',
      6: 'Psalm 112',
      7: 'Psalm 145',
      8: 'Proverbs 31:10-31 (Eshet Chayil)',
      9: 'Psalm 119 (Section 1 of 8)',
      10: 'Psalm 119 (Section 2 of 8)',
      11: 'Psalm 119 (Section 3 of 8)',
      12: 'Psalm 119 (Section 4 of 8)',
      13: 'Psalm 119 (Section 5 of 8)',
      14: 'Psalm 119 (Section 6 of 8)',
      15: 'Psalm 119 (Section 7 of 8)',
      16: 'Psalm 119 (Section 8 of 8)',
      17: 'Psalm 150 (Vowels - half cycle)'
    };
    
    const acrosticPsalm = ACROSTIC_PSALMS[cy22.cycle] || '';
    const acrosticRow = acrosticPsalm 
      ? `<div class="detail-row"><span class="detail-label">Acrostic Psalm:</span><span class="detail-value">${acrosticPsalm}</span></div>`
      : '';
    
    document.getElementById('chochmah-detail').innerHTML =
      `<div class="detail-row"><span class="detail-label">Cycle Letters:</span><span class="detail-value">${cy22.letters} — ${cy22.hebrew}</span></div>
       <div class="detail-row"><span class="detail-label">Daily Letter:</span><span class="detail-value">Day ${cy22.day} · ${cy22.dailyLetter} ${cy22.dailyHebrew}</span></div>
       <div class="detail-row"><span class="detail-label">Theme:</span><span class="detail-value">${cy22.theme}</span></div>
       <div class="detail-row"><span class="detail-label">Set:</span><span class="detail-value">Set ${cy22.cycle} of 17 · Day ${cy22.day} of 22</span></div>
       ${acrosticRow}
       <div class="detail-row"><span class="detail-label">Sefer Yetzirah:</span><span class="detail-value">32 Paths = 10 Sefirot + 22 Letters (building blocks of Creation)</span></div>
       <div class="detail-row"><span class="detail-label">Three Weeks:</span><span class="detail-value">17 Tammuz → 9 Av = 22 days (internal Alef-Bet cycle)</span></div>
       <div class="detail-row"><span class="detail-label">Acrostic Structure:</span><span class="detail-value">Cycles 1-7: One Psalm each · Cycle 8: Eshet Chayil · Cycles 9-16: Psalm 119 (8 sections)</span></div>`;

    // BINAH — 7×7×7 Sefirot Omer Cycle
    // 364 days = 7 cycles of 52 weeks; each cycle of 7 weeks × 7 days = 49 days + 1 overflow
    // 364 / 49 ≈ 7.43 full Omer cycles. We show position within the continuous 343-day (7×7×7) structure
    const SEFIROT_NAMES = ['Chesed','Gevurah','Tiferet','Netzach','Hod','Yesod','Malchut'];
    const omerPos = ((d - 1) % 49) + 1; // position within current 49-day Omer cycle (1–49)
    const omerCycle = Math.floor((d - 1) / 49) + 1;
    const omerWeek = Math.ceil(omerPos / 7);
    const omerDay = ((omerPos - 1) % 7) + 1;
    const weekSef = SEFIROT_NAMES[omerWeek - 1];
    const daySef  = SEFIROT_NAMES[omerDay - 1];
    const combo   = `${daySef} she'be${weekSef}`;
    // Deeper 7×7×7: which of the 7 "super-cycles" of 49 days (1–7)
    const superCycle = Math.min(omerCycle, 7);
    const superSef   = SEFIROT_NAMES[superCycle - 1];
    document.getElementById('binah-cycle-name').textContent = 'Sefirot — 7×7×7 Omer Cycle';
    document.getElementById('binah-main').innerHTML =
      `<strong>${combo}</strong>`;
    document.getElementById('binah-sub').textContent =
      `${daySef} of ${weekSef} — Cycle ${omerCycle}, Week ${omerWeek}, Day ${omerDay}`;
    document.getElementById('binah-tags').innerHTML =
      `<span class="tag highlight">${weekSef}</span><span class="tag">${daySef}</span><span class="tag">Omer ${omerPos} / Cycle ${omerCycle}</span>`;
    document.getElementById('binah-detail').innerHTML =
      `<div class="detail-row"><span class="detail-label">Combination:</span><span class="detail-value">${combo}</span></div>
       <div class="detail-row"><span class="detail-label">Week:</span><span class="detail-value">Week ${omerWeek} of 7 — ${weekSef}</span></div>
       <div class="detail-row"><span class="detail-label">Day:</span><span class="detail-value">Day ${omerDay} of 7 — ${daySef}</span></div>
       <div class="detail-row"><span class="detail-label">Omer Cycle:</span><span class="detail-value">Cycle ${omerCycle} · Position ${omerPos} of 49</span></div>
       <div class="detail-row"><span class="detail-label">50 Gates:</span><span class="detail-value">49 Gates of Understanding + 1 (Shavuot / Matan Torah)</span></div>`;

    // CHESED — Mishna / Tosefta
    const mishnaInfo = getMishnaInfo(d);
    document.getElementById('chesed-cycle-name').textContent =
      mishnaInfo.type === 'mishna' ? 'Mishna — Oral Torah' : 'Tosefta — Expanded Oral Torah';
    document.getElementById('chesed-main').innerHTML = mishnaInfo.text;
    document.getElementById('chesed-sub').textContent = mishnaInfo.sub;
    document.getElementById('chesed-tags').innerHTML =
      `<span class="tag highlight">${mishnaInfo.tag1}</span><span class="tag">${mishnaInfo.tag2}</span>`;
    document.getElementById('chesed-detail').innerHTML =
      `<div class="detail-row"><span class="detail-label">KoT Week:</span><span class="detail-value">Week ${mishnaInfo.week}, Day ${mishnaInfo.day} of 7</span></div>
       <div class="detail-row"><span class="detail-label">Cycle:</span><span class="detail-value">${mishnaInfo.type === 'mishna' ? '10 chapters/week · Days 1–5' : '8 chapters/week · Days 6–7'}</span></div>`;

    // GEVURAH — Tanach
    const tanachInfo = getTanachInfo(d);
    document.getElementById('gevurah-cycle-name').textContent = 'Tanach — 2 Chapters Daily';
    document.getElementById('gevurah-main').innerHTML = tanachInfo.text;
    document.getElementById('gevurah-sub').textContent = tanachInfo.sub;
    document.getElementById('gevurah-tags').innerHTML =
      `<span class="tag highlight">${tanachInfo.tag1}</span><span class="tag">${tanachInfo.tag2}</span>`;
    document.getElementById('gevurah-detail').innerHTML =
      `<div class="detail-row"><span class="detail-label">Section:</span><span class="detail-value">${tanachInfo.sub}</span></div>
       <div class="detail-row"><span class="detail-label">Cycle:</span><span class="detail-value">2 chapters/day · 364 days · 52 weeks</span></div>`;

    // TIFERET — 13-day (Micha's 13 Attributes of Mercy)
    cards[4].querySelector('.sefirah-cycle-name').textContent = 'Micha\'s 13 Attributes — 13-Day Cycle';
    cards[4].querySelector('.sefirah-main-text').innerHTML =
      `Cycle <strong>${cy13.cycle}</strong> · Attribute <strong>${cy13.day}</strong>: ${cy13.attr.name} <span style="font-size:0.95em;opacity:0.8">${cy13.attr.hebrew}</span>`;
    cards[4].querySelector('.sefirah-sub-text').textContent = cy13.attr.meaning;
    cards[4].querySelector('.sefirah-tags').innerHTML =
      `<span class="tag highlight">Cycle ${cy13.cycle} · Day ${cy13.day}</span><span class="tag">${cy13.attr.name}</span>`;
    
    // Determine cycle theme based on which set of 13 it's in
    let cycleTheme = '';
    if (cy13.cycle <= 13) {
      // Cycles 1-13: Micha's attributes (inner vessels)
      const michaAttr = THIRTEEN_ATTRIBUTES[cy13.cycle - 1];
      cycleTheme = `Cycle Theme: ${michaAttr.name} — ${michaAttr.meaning} (Micha's Inner Vessel)`;
    } else if (cy13.cycle <= 26) {
      // Cycles 14-26: Moshe's attributes (outer vessels)
      const mosheNum = cy13.cycle - 13;
      const MOSHE_ATTRIBUTES = [
        'Hashem (1st)', 'Hashem (2nd)', 'El', 'Rachum', "Ve'chanun", 'Erech Apayim',
        "Ve'rav Chesed", "Ve'emet", 'Notzer Chesed', "La'alafim", 'Noseh Avon',
        'Vafeshah', "VeChata'ah"
      ];
      cycleTheme = `Cycle Theme: ${MOSHE_ATTRIBUTES[mosheNum - 1]} (Moshe's Outer Vessel)`;
    } else if (cy13.cycle === 27) {
      cycleTheme = `Cycle Theme: Microcosm of Micha's 13 Attributes (Inner Vessels)`;
    } else {
      cycleTheme = `Cycle Theme: Microcosm of Moshe's 13 Attributes (Outer Vessels)`;
    }
    
    cards[4].querySelector('.sefirah-detail').innerHTML =
      `<div class="detail-row"><span class="detail-label">Nassi:</span><span class="detail-value">${cy13.nassi}</span></div>
       <div class="detail-row"><span class="detail-label">Daily Attribute:</span><span class="detail-value">${cy13.attr.name} — ${cy13.attr.meaning}</span></div>
       <div class="detail-row"><span class="detail-label">Hebrew:</span><span class="detail-value">${cy13.attr.hebrew}</span></div>
       <div class="detail-row"><span class="detail-label">${cycleTheme.split(':')[0]}:</span><span class="detail-value">${cycleTheme.split(':')[1]}</span></div>
       <div class="detail-row"><span class="detail-label">Source:</span><span class="detail-value">Micah 7:18-20 — Prophet Micha's vision of Divine mercy</span></div>
       <div class="detail-row"><span class="detail-label">Structure:</span><span class="detail-value">Cycles 1-13 (Micha/Inner) · 14-26 (Moshe/Outer) · 27-28 (Microcosm)</span></div>`;

    // NETZACH — 41-day (enriched with soul levels + mivtzah + commandment)
    const cycleCmd = CYCLE_COMMANDMENTS[cy41.cycle - 1];
    cards[5].querySelector('.sefirah-cycle-name').textContent = `41-Day Cycle`;
    cards[5].querySelector('.sefirah-main-text').innerHTML =
      `Cycle <strong>${cy41.cycle}</strong> · Day <strong>${cy41.day}</strong> of 41`;
    cards[5].querySelector('.sefirah-sub-text').textContent = `${cycleCmd.theme} · ${cy41.soulLevel}`;
    cards[5].querySelector('.sefirah-tags').innerHTML =
      `<span class="tag highlight">${cycleCmd.theme}</span><span class="tag">${cy41.soulLevel}</span><span class="tag">Day ${cy41.day} of 41</span>`;
    cards[5].querySelector('.sefirah-detail').innerHTML =
      `<div class="detail-row"><span class="detail-label">Mivtzah:</span><span class="detail-value">${cy41.mivtzah} (Cycle ${cy41.cycle} of 9)</span></div>
       <div class="detail-row"><span class="detail-label">Commandment ${cy41.cycle}:</span><span class="detail-value">${cycleCmd.commandment} — ${cycleCmd.theme}</span></div>
       <div class="detail-row"><span class="detail-label">Soul Level:</span><span class="detail-value">${cy41.soulLevel} · Day ${cy41.dayInLevel} of 10</span></div>
       <div class="detail-row"><span class="detail-label">World:</span><span class="detail-value">${cy41.soulLevel.includes('Nefesh') ? 'Asiyah — Action & Physical' : cy41.soulLevel.includes('Ruach') ? 'Yetzirah — Emotional World' : cy41.soulLevel.includes('Neshamah') ? 'Beriah — Intellectual World' : cy41.soulLevel.includes('Chayah') ? 'Atzilut — Spiritual World' : 'Adam Kadmon — Yechidah (Day 41)'}</span></div>
       <div class="detail-row"><span class="detail-label">Structure:</span><span class="detail-value">9 cycles × 41 days = 369 days · 7th cycle = Shavuot→17 Tammuz</span></div>`;

    // HOD — Halacha
    if (!hal.chofetz) {
      cards[6].querySelector('.sefirah-main-text').innerHTML =
        `Shulchan Aruch, Orach Chaim <strong>${hal.ch1}</strong> & <strong>${hal.ch2}</strong>`;
      cards[6].querySelector('.sefirah-sub-text').textContent = 'Mishnah Berurah included';
      cards[6].querySelector('.sefirah-detail').innerHTML =
        `<div class="detail-row"><span class="detail-label">Chapters:</span><span class="detail-value">Orach Chaim ${hal.ch1} & ${hal.ch2}</span></div>` +
        `<div class="detail-row"><span class="detail-label">Commentary:</span><span class="detail-value">Mishnah Berurah by the Chofetz Chaim</span></div>` +
        `<div class="detail-row"><span class="detail-label">Cycle:</span><span class="detail-value">2 chapters/day · Chapters 1-697 · Days 1-348</span></div>` +
        `<div class="detail-row"><span class="detail-label">Year end:</span><span class="detail-value">Sefer Chofetz Chaim (Days 349-364)</span></div>`;
    } else {
      cards[6].querySelector('.sefirah-main-text').innerHTML =
        `Sefer Chofetz Chaim — Section <strong>${hal.section}</strong>`;
      cards[6].querySelector('.sefirah-sub-text').textContent = 'Laws of proper speech';
      cards[6].querySelector('.sefirah-detail').innerHTML =
        `<div class="detail-row"><span class="detail-label">Section:</span><span class="detail-value">Day ${d} of year · Section ${hal.section} of Chofetz Chaim</span></div>` +
        `<div class="detail-row"><span class="detail-label">Topic:</span><span class="detail-value">Laws of proper speech (lashon hara, rechilut)</span></div>` +
        `<div class="detail-row"><span class="detail-label">Days:</span><span class="detail-value">Days 349-364 of the year</span></div>`;
    }


    // ── MALCHUT — Daily text (Day 1–7) each paired with its KoT Book
    const malTxt = getMalchutText(sef.dayNum);
    const wk = getWeeklyData(sef.weekNum);

    // Each KoT day = one daily text = one KoT Book
    // Shown on card face: today's text name + book label + first content line
    const DAY_BOOKS = [
      // Index 0-6 matches MALCHUT_TEXTS and day order (0=Fri, 1=Shab, 2=Sun, 3=Mon, 4=Tue, 5=Wed, 6=Thu)
      // KoT Days: 1=Fri→Book1, 2=Shab→Book2, 3=Sun→Book3, 4=Mon→Book4, 5=Tue→Book5, 6=Wed→Book6, 7=Thu→Book7
      { book: 'Book 1 · Song of Nature',        emoji: '🐾',
        fields: [{ label: 'Weekly Theme',      value: wk.b1_theme },
                 { label: 'Perek Shirah',      value: (() => { const ps = PEREK_SHIRAH_VERSES[wk.b1_animal]; return ps ? wk.b1_animal + ' (' + ps[0] + ') — ' + ps[1] : wk.b1_animal; })() },
                 { label: 'Pirkei Avot',       value: wk.b1_avot }] },
      { book: 'Book 2 · Song of Moses',        emoji: '📜',
        fields: [{ label: '48 Qualities',      value: wk.b2_quality },
                 { label: 'Prophet',           value: wk.b2_prophet }] },
      { book: 'Book 3 · Song of the Sea',      emoji: '🌾',
        fields: [{ label: 'Ruth Genealogy',    value: wk.b3_ruth },
                 { label: 'Haftara',           value: wk.b3_haftara }] },
      // BOOK 4: Song of Hannah (Saved in 2016)
      { book: 'Book 4 · Song of Hannah',       emoji: '💎',
        fields: [{ label: 'Proverbs',          value: wk.b4_proverbs }] },
      { book: 'Book 5 · Song of Songs',      emoji: '🌹',
        fields: [{ label: 'Song of Songs',     value: wk.b5_shir }] },
      { book: 'Book 6 · General Remedy',      emoji: '🎵',
        fields: [{ label: 'Tikkun HaKlali',    value: wk.b6_psalms }] },
      // BOOK 7: Gathering of Songs (Saved in 2013)
      { book: 'Book 7 · Gathering of Songs',    emoji: '🪜',
        fields: [
          { label: 'Gathering of Songs', value: wk.b7_theme 
            ? `<a href="${wk.b7_url}" target="_blank" style="color:var(--gold)">${wk.b7_theme} ↗</a>`
            : '(See blog for this week\'s gathering)' }
        ] },
    ];

    const todayBook = DAY_BOOKS[sef.dayNum - 1];

    // Card face
    document.getElementById('malchut-cycle-name').textContent =
      `Day ${sef.dayNum} · ${malTxt.day}`;
    document.getElementById('malchut-main').innerHTML =
      `<strong>${malTxt.name}</strong>`;
    document.getElementById('malchut-sub').innerHTML =
      `${malTxt.author}`;
    document.getElementById('malchut-tags').innerHTML =
      `<span class="tag highlight">${todayBook.emoji} ${todayBook.book}</span>` +
      `<span class="tag">${wk.b1_theme}</span>`;

    // Detail panel: today's entry highlighted, then full weekly context
    const DAYS_LABELS = ['Friday','Shabbat','Sunday','Monday','Tuesday','Wednesday','Thursday'];
    const TEXTS  = ['Zohar / Arizal','Likutei Sichos','Keter Shem Tov',
                    'Noam Elimelech','Tanya','Likutei Moharan','Mesilat Yesharim'];

    // Today's highlighted entry
    const todayMalTxt = getMalchutText(sef.dayNum);
    const todayIdx = sef.dayNum - 1;
    const todayFieldLines = todayBook.fields.map(f =>
      `<div class="mal-field">` +
        `<span class="mal-field-label">${f.label}</span>` +
        `<span class="mal-field-value">${f.value}</span>` +
      `</div>`
    ).join('');
    
    const todayRow = `<div class="mal-today-highlight">` +
      `<div class="mal-today-badge">★ Today's Reading</div>` +
      `<div class="mal-book-row mal-today">` +
        `<div class="mal-book-header">` +
          `<span class="mal-night">${DAYS_LABELS[todayIdx]}</span>` +
          `<span class="mal-text-name">${TEXTS[todayIdx]}</span>` +
          `<span class="mal-book-label">${todayBook.emoji} ${todayBook.book}</span>` +
        `</div>` +
        `<div class="mal-fields">${todayFieldLines}</div>` +
      `</div>` +
      `</div>`;

    // Full 7-day week for context
    const weekRows = DAY_BOOKS.map((db, i) => {
      const isCurrent = (i + 1) === sef.dayNum;
      const fieldLines = db.fields.map(f =>
        `<div class="mal-field">` +
          `<span class="mal-field-label">${f.label}</span>` +
          `<span class="mal-field-value">${f.value}</span>` +
        `</div>`
      ).join('');
      return `<div class="mal-book-row${isCurrent ? ' mal-today' : ''}">` +
        `<div class="mal-book-header">` +
          `<span class="mal-night">${DAYS_LABELS[i]}</span>` +
          `<span class="mal-text-name">${TEXTS[i]}</span>` +
          `<span class="mal-book-label">${db.emoji} ${db.book}</span>` +
        `</div>` +
        `<div class="mal-fields">${fieldLines}</div>` +
        `</div>`;
    }).join('');

    document.getElementById('malchut-detail').innerHTML =
      todayRow +
      `<div class="mal-week-divider"></div>` +
      `<div class="mal-parasha-header">` +
        `<span>Week ${sef.weekNum} · ${wk.month}</span>` +
        `<strong>${wk.b1_theme}</strong>` +
      `</div>` +
      weekRows;
  }

  function changeDay(delta) {
    currentOffset += delta;
    document.querySelectorAll('.sefirah-card.expanded').forEach(c => c.classList.remove('expanded'));
    render();
  }

  function toggleExpand(card) {
    card.classList.toggle('expanded');
  }

  function toggleKeterExpand(card, event) {
    // Don't toggle if clicking on a link
    if (event && event.target.tagName === 'A') {
      return;
    }
    card.classList.toggle('expanded');
  }

  render();

  // ══════════════════════════════════════════════════════════════
  // PWA SERVICE WORKER REGISTRATION
  // ══════════════════════════════════════════════════════════════
  
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then((registration) => {
          console.log('ServiceWorker registered successfully:', registration.scope);
        })
        .catch((error) => {
          console.log('ServiceWorker registration failed:', error);
        });
    });
  }
</script>

</body>
</html>
